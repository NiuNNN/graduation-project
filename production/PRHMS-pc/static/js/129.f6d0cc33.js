"use strict";(self["webpackChunkpc_web"]=self["webpackChunkpc_web"]||[]).push([[129],{2129:function(t,e,s){s.d(e,{Z:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[0==t.active?e("div",[e("p",{staticClass:"header"},[t._v("订单编号："+t._s(t.order.outTradeNo))]),e("div",{staticClass:"pay"},[t._v(t._s(t.payTitle))]),e("p",{staticClass:"header"},[t._v("请选择支付方式：")]),e("div",{staticStyle:{"margin-top":"30px","padding-left":"15px"}},[e("el-button",{on:{click:t.alipay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("支付宝支付")]),e("el-button",{on:{click:t.cashpay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("现金支付")])],1),e("p",{staticStyle:{color:"#303133","font-size":"14px",padding:"25px 15px 0"}},[t._v("*支付后请点击此"),e("el-button",{attrs:{type:"text"},on:{click:t.judgePay}},[t._v("刷新")])],1)]):t._e(),1==t.active?e("div",[e("el-result",{attrs:{icon:"success",title:"支付成功",subTitle:`缴费成功，${t.count}秒后关闭页面`}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.close}},[t._v("确定")])],1)],2)],1):t._e()])},i=[],r=s(7535),l={data(){return{active:0,count:"",timer:""}},props:{order:{type:Object,default:()=>({})}},computed:{payTitle(){return console.log(this.order),`待支付：￥${this.order.total}`}},methods:{async alipay(){this.judgePay();try{const{data:t}=await(0,r.Gh)({...this.order,subject:"押金",userId:this.$store.getters.userId}),e=window.open("","_target");e.document.write(t),e.focus()}catch(t){console.log(t)}},cashpay(){this.judgePay(),this.$confirm("确定收款成功, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(0,r.bD)({...this.order,userId:this.$store.getters.userId}),this.active++}))},async judgePay(){try{const{data:t}=await(0,r.v6)(this.order);t>0&&(this.$message.success("支付成功"),this.payTitle=`已支付：￥${this.order.total}`,this.active++)}catch(t){console.log(t)}},countDown(){const t=3;this.timer||(this.count=t,this.timer=setInterval((()=>{this.count>1&&this.count<=t?this.count--:(clearInterval(this.timer),this.timer=null,this.close())}),1e3))},close(){this.$emit("closePayDrawer")}},watch:{active(t,e){1==t&&this.countDown()}}},o=l,n=s(1001),c=(0,n.Z)(o,a,i,!1,null,"1f71a2fa",null),u=c.exports},2100:function(t,e,s){s.r(e),s.d(e,{default:function(){return pt}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-container"},[t._m(0),e("div",[e("create-user")],1),e("div",{staticClass:"bg"},[e("div",{staticClass:"navbar"},[e("span",{class:{current:"in"==t.isCurrent},on:{click:function(e){return t.changeCurrent("in")}}},[t._v("已 入 住 用 户")]),e("span",{class:{current:"house"==t.isCurrent},on:{click:function(e){return t.changeCurrent("house")}}},[t._v("待 添 加 房 间")]),e("span",{class:{current:"pay"==t.isCurrent},on:{click:function(e){return t.changeCurrent("pay")}}},[t._v("待 缴 纳 押 金")]),e("span",{class:{current:"out"==t.isCurrent},on:{click:function(e){return t.changeCurrent("out")}}},[t._v("已 退 房 用 户")])]),e("div",{staticClass:"table"},[e("div",{staticClass:"top"},[e("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.searchForm,"label-width":"50px"}},[e("el-form-item",{attrs:{label:"姓名"}},[e("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name",e)},expression:"searchForm.name"}})],1),e("el-form-item",{attrs:{label:"账号"}},[e("el-input",{attrs:{placeholder:"请输入账号"},model:{value:t.searchForm.username,callback:function(e){t.$set(t.searchForm,"username",e)},expression:"searchForm.username"}})],1),"house"!=t.isCurrent?e("el-form-item",{attrs:{label:"房号"}},[e("el-input",{attrs:{placeholder:"请输入房号"},model:{value:t.searchForm.houseName,callback:function(e){t.$set(t.searchForm,"houseName",e)},expression:"searchForm.houseName"}})],1):t._e(),e("el-form-item",[e("el-button",{staticStyle:{height:"35px"},attrs:{type:"primary",disabled:t.isGet},on:{click:t.search}},[t._v("查询")])],1)],1)],1),e("div",{staticClass:"bottom"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":200}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"name",label:"头像",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-avatar",{directives:[{name:"imageerror",rawName:"v-imageerror",value:t.defaultImg,expression:"defaultImg"}],attrs:{src:`${t.targetUrl}/view/Avatar/${s.row.avatar}`}})]}}])}),e("el-table-column",{attrs:{prop:"username",label:"账号"}}),e("el-table-column",{attrs:{prop:"name",label:"姓名",width:"100"}}),"house"!=t.isCurrent?e("el-table-column",{attrs:{prop:"houseName",label:"房号",width:"100"}}):t._e(),e("el-table-column",{attrs:{prop:"phone",label:"手机"}}),e("el-table-column",{attrs:{prop:"idcard",label:"身份证"}}),e("el-table-column",{attrs:{prop:"addtime",label:"添加时间"}}),e("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(s){return["in"==t.isCurrent?[e("el-button",{attrs:{size:"mini",disabled:t.isGet,type:"primary"},on:{click:function(e){return t.openDrawer(s.row)}}},[t._v("查看")])]:t._e(),"house"==t.isCurrent?[e("el-button",{attrs:{size:"mini",type:"primary",disabled:t.isAdd},on:{click:function(e){return t.openAddHouseDrawer(s.row)}}},[t._v("添加")]),e("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",disabled:t.isDel},on:{click:function(e){return t.deleteUser(s.row)}},slot:"reference"},[t._v("删除")])]:t._e(),"pay"==t.isCurrent?[e("el-button",{attrs:{size:"mini",disabled:t.isAdd,type:"primary"},on:{click:function(e){return t.openPayDrawer(s.row)}}},[t._v("付款")])]:t._e(),"out"==t.isCurrent?[e("el-button",{attrs:{size:"mini",disabled:t.isGet,type:"primary"},on:{click:function(e){return t.openDrawer(s.row)}}},[t._v("查看")])]:t._e()]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{"current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,background:"",layout:"prev, pager, next",total:t.pagination.total},on:{"current-change":t.handleCurrentChange}})],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"住客详细信息",visible:t.drawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.drawer=e}}},[e("drawer-user-detail",{attrs:{tableData:t.miscellaneousData,user:t.user,isDel:t.isDel,isEdit:t.isEdit,isOut:t.isOut},on:{updateIdcard:t.updateIdcard,updateHouse:t.updateHouse,updateBasic:t.updateBasic}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{wrapperClosable:!1,"show-close":!1,title:"修改租客个人信息",visible:t.idcardDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.idcardDrawer=e}}},[e("update-user",{attrs:{user:t.user},on:{updateUser:t.updateUser}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{wrapperClosable:!1,"show-close":!1,title:"修改租房信息",visible:t.houseDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.houseDrawer=e}}},[e(t.updateHouseComponent,{tag:"component",attrs:{user:t.user,house:t.houseData,miscellaneous:t.miscellaneousData},on:{afterUpdateHouse:t.afterUpdateHouse,changeUpdateHouseComponent:t.changeUpdateHouseComponent}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{wrapperClosable:!1,"show-close":!1,title:"添加杂费信息",visible:t.basicDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.basicDrawer=e}}},[e("update-basic",{attrs:{"table-data":t.miscellaneousData,user:t.user,isDel:t.isDel,isAdd:t.isAdd},on:{deleteMiscellaneous:t.deleteMiscellaneous,afterUpdateBasic:t.afterUpdateBasic}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"办理入住",wrapperClosable:!1,"show-close":!1,visible:t.addHouseDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.addHouseDrawer=e}}},[e("login-house",{attrs:{user:t.user},on:{closeAddHouseDrawer:t.closeAddHouseDrawer}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"缴纳押金",visible:t.payDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.payDrawer=e}}},[e("pay",{attrs:{order:t.order},on:{closePayDrawer:t.closePayDrawer}})],1)],1)],1)])])])},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-container"},[e("h1",[t._v("住 户 管 理")])])}],r=s(2900),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg"},[e("div",{staticClass:"collapse-container"},[e("el-collapse",{staticStyle:{"border-top":"none"},attrs:{accordion:""},on:{change:t.createUserName},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-collapse-item",{attrs:{name:"1"},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"collapse-title"},[e("span",[t._v("添 加 新 住 户")])])]},proxy:!0}])},[e("div",{staticClass:"bg-container"},[e("div",{staticClass:"insert"},[e("div",{staticClass:"top"},[e("el-steps",{attrs:{active:t.active,"finish-status":"success"}},[e("el-step",{attrs:{title:"上传住户信息"}}),e("el-step",{attrs:{title:"确认住户信息"}}),e("el-step",{attrs:{title:"选择房屋信息"}}),e("el-step",{attrs:{title:"选择房屋杂费"}}),e("el-step",{attrs:{title:"确认房屋信息"}}),e("el-step",{attrs:{title:"签署合同"}}),e("el-step",{attrs:{title:"支付押金"}}),e("el-step",{attrs:{title:"完成"}})],1)],1),0===t.active?e("div",[e("div",{staticClass:"middle"},[e("h3",[t._v("账号: "+t._s(t.username))]),e("el-form",{ref:"userForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.userForm,size:"small",rules:t.rules}},[e("el-form-item",{attrs:{label:"住户电话:",prop:"phone"}},[e("el-input",{attrs:{placeholder:"请输入住户电话"},model:{value:t.userForm.phone,callback:function(e){t.$set(t.userForm,"phone",e)},expression:"userForm.phone"}})],1)],1),e("div",{staticClass:"idcard"},[e("span",{staticClass:"idcard-header"},[e("i",{staticStyle:{color:"#ff2855","margin-right":"4px"}},[t._v("*")]),t._v("身份证照片")]),e("el-row",{staticStyle:{padding:"0 25px"},attrs:{gutter:20,justify:"space-between"}},[e("el-col",{attrs:{span:9}},[e("div",{class:[{error:t.isErrorFont},{idcard_container:!0}],on:{click:function(e){return t.uploadAvatar("font")}}},[e("input",{ref:"fontRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpeg"},on:{change:function(e){return t.onFileChange(e,"font")}}}),t.fontUrl?e("img",{attrs:{src:t.fontUrl,alt:""}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"},[t._v("带国徽面")])])]),e("el-col",{attrs:{span:9}},[e("div",{class:[{error:t.isErrorBack},{idcard_container:!0}],on:{click:function(e){return t.uploadAvatar("back")}}},[e("input",{ref:"backRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpeg"},on:{change:function(e){return t.onFileChange(e,"back")}}}),t.backUrl?e("img",{attrs:{src:t.backUrl,alt:""}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"},[t._v("带头像面")])])])],1)],1)],1),e("div",{staticClass:"bottom",staticStyle:{"margin-top":"60px"}},[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.firstStep}},[t._v("下一步")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)]):t._e(),1===t.active?e("div",[e("div",{staticClass:"middle"},[e("el-descriptions",{staticClass:"margin-top",attrs:{title:`账号：${t.user.username}`,column:3}},[e("el-descriptions-item",{attrs:{label:"姓名"}},[t._v(t._s(t.user.name))]),e("el-descriptions-item",{attrs:{label:"性别"}},[t._v(t._s(t.user.sex))]),e("el-descriptions-item",{attrs:{label:"民族"}},[t._v(t._s(t.user.nation))]),e("el-descriptions-item",{attrs:{label:"生日"}},[t._v(t._s(t.user.birthday))]),e("el-descriptions-item",{attrs:{label:"身份证"}},[t._v(t._s(t.user.idcard))]),e("el-descriptions-item",{attrs:{label:"手机号"}},[t._v(t._s(t.user.phone))]),e("el-descriptions-item",{attrs:{label:"签订时间"}},[t._v(t._s(t.user.sign))]),e("el-descriptions-item",{attrs:{label:"过期时间"}},[t._v(t._s(t.user.lose))]),e("el-descriptions-item",{attrs:{label:"签订机构"}},[t._v(t._s(t.user.authority))]),e("el-descriptions-item",{attrs:{label:"地址"}},[t._v(t._s(t.user.address))])],1)],1),e("div",{staticClass:"bottom"},[t.secondStepBtn?[e("el-button",{attrs:{type:"primary",disabled:!0}},[t._v("确认无误后，下一步("+t._s(t.second)+"s)")])]:[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.secondStep}},[t._v("下一步")])],e("el-button",{on:{click:function(e){return t.back()}}},[t._v("返 回")])],2)]):t._e(),2===t.active?e("div",[e("div",{staticClass:"middle"},[e("div",{staticClass:"form"},[e("el-form",{staticClass:"demo-form-inline",staticStyle:{"padding-right":"0"},attrs:{inline:!0,model:t.houseForm,size:"small"}},[e("el-row",[e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"房型"}},[e("el-select",{attrs:{placeholder:"请选择房型"},model:{value:t.houseForm.styleName,callback:function(e){t.$set(t.houseForm,"styleName",e)},expression:"houseForm.styleName"}},t._l(t.styleList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.styleName,value:t.styleName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"楼层"}},[e("el-select",{attrs:{placeholder:"请选择楼层"},model:{value:t.houseForm.floor,callback:function(e){t.$set(t.houseForm,"floor",e)},expression:"houseForm.floor"}},t._l(t.floorList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.floorName,value:t.floorName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"阳台"}},[e("el-select",{attrs:{placeholder:"请选择阳台"},model:{value:t.houseForm.balcony,callback:function(e){t.$set(t.houseForm,"balcony",e)},expression:"houseForm.balcony"}},[e("el-option",{attrs:{label:"有",value:"有"}}),e("el-option",{attrs:{label:"无",value:"无"}})],1)],1)],1),e("el-col",{attrs:{span:3}},[e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.getHouse}},[t._v("查询")])],1)],1)],1)],1)],1),e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请选择房间：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":"",height:"384",border:""},on:{"row-click":t.singleElection}},[e("el-table-column",{attrs:{width:"55",label:"选择"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-radio",{staticClass:"radio",attrs:{label:s.row.houseId},model:{value:t.templateSelection,callback:function(e){t.templateSelection=e},expression:"templateSelection"}},[t._v(" ")])]}}],null,!1,3666378396)}),e("el-table-column",{attrs:{prop:"houseName",label:"房号"}}),e("el-table-column",{attrs:{prop:"styleName",label:"房型"}}),e("el-table-column",{attrs:{prop:"balcony",label:"阳台"}}),e("el-table-column",{attrs:{prop:"area",label:"面积(㎡)"}}),e("el-table-column",{attrs:{prop:"price",label:"房屋租金(月/元)"}})],1)],1)]),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.thirdStep}},[t._v("下一步")]),e("el-button",{attrs:{disabled:t.isAdd},on:{click:function(e){t.active=8}}},[t._v("跳过")])],1)]):t._e(),3===t.active?e("div",[e("div",{staticClass:"middle"},[e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请选择杂费：")]),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.baseData,"tooltip-effect":"dark",height:"438",border:"","row-key":t.getRowKey},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费说明"}})],1)],1)]),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:function(e){t.active--}}},[t._v("上一步")]),e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.forthStep}},[t._v("下一步")])],1)]):t._e(),4===t.active?e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("已选择房间：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.checkList,"highlight-current-row":"",size:"mini",border:""},on:{"row-click":t.singleElection}},[e("el-table-column",{attrs:{prop:"houseName",label:"房号"}}),e("el-table-column",{attrs:{prop:"styleName",label:"房型"}}),e("el-table-column",{attrs:{prop:"balcony",label:"阳台"}}),e("el-table-column",{attrs:{prop:"area",label:"面积(㎡)"}}),e("el-table-column",{attrs:{prop:"price",label:"房屋租金(月/元)"}}),e("el-table-column",{attrs:{prop:"deposit",label:"总租金(月/元)"}})],1),e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("已选择杂费：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.multipleSelection,"highlight-current-row":"",size:"mini",height:"300",border:""},on:{"row-click":t.singleElection}},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费说明"}})],1)],1),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.backThird}},[t._v("上一步")]),e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.fithStep}},[t._v("下一步")])],1)]):t._e(),5===t.active?e("div",[t.contractShow?e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("签署合同")]),e("iframe",{staticStyle:{width:"100%",height:"450px"},attrs:{frameborder:"0",src:t.pdfSrc}})]),e("div",{staticClass:"bottom"},[e("el-button",{on:{click:function(e){t.dialogVisible=t.active--}}},[t._v("上一步")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.signVisible=!0}}},[t._v("确 定")])],1)]):e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("合同签署完毕")]),e("iframe",{staticStyle:{width:"100%",height:"450px"},attrs:{frameborder:"0",src:t.pdfSrc}})]),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary"},on:{click:t.sixth}},[t._v("确 定")])],1)]),e("el-dialog",{attrs:{title:"电子签名",visible:t.signVisible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.signVisible=e}}},[e("sign-canvas",{on:{back:t.backContract,commitSign:t.writeSign}})],1)],1):t._e(),6===t.active?e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"18px","border-left":"5px solid #3a3f63","padding-left":"5px"}},[t._v("订单编号："+t._s(t.order.outTradeNo))]),e("div",{staticClass:"pay"},[t._v(t._s(t.payTitle))]),e("p",{staticStyle:{color:"#303133","font-size":"18px","border-left":"5px solid #3a3f63","padding-left":"5px"}},[t._v("请选择支付方式：")]),e("div",{staticStyle:{"margin-top":"30px","padding-left":"15px"}},[e("el-button",{on:{click:t.alipay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("支付宝支付")]),e("el-button",{on:{click:t.cashpay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("现金支付")])],1),e("p",{staticStyle:{color:"#303133","font-size":"14px",padding:"25px 15px 0"}},[t._v("*支付后请点击此"),e("el-button",{attrs:{type:"text"},on:{click:t.judgePay}},[t._v("刷新")]),t._v("，若稍后支付，可点击"),e("el-button",{staticStyle:{color:"#ff2855","margin-left":"0"},attrs:{type:"text"},on:{click:function(e){t.active+=2}}},[t._v("跳过...")])],1)])]):t._e(),8===t.active?e("div",[e("el-result",{attrs:{icon:"success",title:"信息录入成功",subTitle:"租客录入成功，3秒后刷新页面"}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.flash}},[t._v("确定")])],1)],2)],1):t._e()])])])],1)],1)])},o=[];s(7658);function n(t,e){let s=Number(e[0].price.replace(/,/g,""));return t.length>0&&t.forEach((t=>{s+=Number(t.price.replace(/,/g,""))})),e[0].deposit=d(p(s)),e}function c(t){let e=0;return t.length>0&&t.forEach((t=>{e+=Number(t.price.replace(/,/g,""))})),d(p(e))}function u(t){let e=[];return t.length>0?(t.forEach((t=>{e.push(t.baseId)})),e.join(",")):""}function d(t){if(t=t.toString(),-1!=t.indexOf(".")){let e=t.split(".");1==e[1].length&&(e=e.join("."),e+="0",t=e)}else t+=".00";return t}function p(t){t=(t||0).toString();var e="";while(t.length>3)e=","+t.slice(-3)+e,t=t.slice(0,t.length-3);return t&&(e=t+e),e}var h=s(5364),m=s(50),b=s(5532),f=s(9176),y=s(5115),g=s(9312);function v(t){return(0,g.v_)("insertRent",t)}function w(t){return(0,g.v_)("changeRent",t)}var _=s(7278),k=s(3811),S=s(6585),C=s(6134),D=s(7535),x={inject:["reload"],components:{SignCanvas:C.Z},data(){const t=(t,e,s)=>{(0,f.Lp)(e)?s():s(new Error("请输入正确的手机号"))};return{activeName:"",active:0,userForm:{phone:""},fontUrl:"",backUrl:"",fontFile:"",backFile:"",username:"",isErrorFont:!1,isErrorBack:!1,rules:{phone:[{required:!0,trigger:"blur",message:"请输入住户手机"},{trigger:"blur",validator:t}]},isfont:!1,isback:!1,firstStepBtn:!1,user:{},secondStepBtn:!0,second:3,timer:null,houseForm:{styleName:"",floor:"",balcony:""},tableData:[],templateSelection:"",checkList:[],floorList:[],styleList:[],baseData:[],multipleSelection:[],pdfSrc:"",signVisible:!1,localSrc:"",contractShow:!0,rentId:"",total:"",order:{},payTitle:""}},methods:{back(){this.active--,this.second=3,clearInterval(this.timer)},close(){this.activeName="",this.userForm.phone="",this.fontUrl="",this.backUrl="",this.fontFile="",this.backFile=""},async createUserName(){try{const{data:t}=await(0,r.Zg)({roleId:1});this.username=t;const{data:e}=await(0,m.W)();this.floorList=e;const{data:s}=await(0,b.zs)();this.styleList=s}catch(t){console.log(t)}},uploadAvatar(t){"font"===t&&this.$refs.fontRef.click(),"back"===t&&this.$refs.backRef.click()},onFileChange(t,e){const s=t.target.files;if(0!==s.length&&this.beforeAvatarUpload(s[0])){const t=new FileReader;t.readAsDataURL(s[0]),t.onload=async t=>{try{"font"===e&&(this.isfont=!1,this.fontUrl=t.target.result,this.fontFile=s[0],this.isErrorFont=!0),"back"===e&&(this.isback=!1,this.backUrl=t.target.result,this.backFile=s[0],this.isErrorBack=!0);const a=new FormData;a.append("file",s[0]),a.append("direction",e);const{data:i}=await(0,r.RA)(a);"font"===i&&(this.isErrorFont=!1,this.isfont=!0),"back"===i&&(this.isErrorBack=!1,this.isback=!0),this.$message.success("校验通过")}catch(a){console.log(a)}}}},beforeAvatarUpload(t){const e="image/jpeg"===t.type,s=t.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&s},firstStep(){this.firstStepBtn=!0,this.$refs.userForm.validate((async t=>{if(t)if(this.isfont&&this.isback)try{const t=new FormData;t.append("font",this.fontFile),t.append("back",this.backFile);const{data:e}=await(0,r.mt)(t);this.user={...e,...this.userForm,username:this.username,state:1},this.active++,this.countTimeOut()}catch(e){console.log(e)}finally{this.firstStepBtn=!1}else this.firstStepBtn=!1,this.$message.error("请上传对应的证件");else this.firstStepBtn=!1}))},countTimeOut(){this.timer=setInterval((()=>{this.second--,0==this.second&&(this.second=10,this.secondStepBtn=!1,clearInterval(this.timer))}),1e3)},async secondStep(){try{const t=new FormData;t.append("font",this.fontFile),t.append("back",this.backFile),t.append("user",JSON.stringify(this.user)),t.append("roleId",1);const{data:e}=await(0,r._Y)(t);this.user=e,this.$message.success("创建成功,请录入房间信息"),this.active++,this.getHouse()}catch(t){console.log(t)}},async getHouse(){try{const{data:t}=await(0,y.YZ)(this.houseForm);this.tableData=t,this.resetHouse()}catch(t){console.log(t)}},resetHouse(){this.houseForm={styleName:"",floor:"",balcony:""}},singleElection(t){this.templateSelection=t.houseId,this.checkList=this.tableData.filter((e=>e.houseId===t.houseId))},async thirdStep(){if(0===this.checkList.length)this.$message.error("请选择房间，再进行下一步");else{const{data:t}=await(0,h.FE)();this.baseData=t,this.active++}},getRowKey(t){return t.baseId},handleSelectionChange(t){this.multipleSelection=t},backThird(){this.multipleSelection=[],this.active--},forthStep(){0==this.multipleSelection.length?this.$confirm("没有选择房屋杂费, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.checkList=n(this.multipleSelection,this.checkList),this.active++})):(this.checkList=n(this.multipleSelection,this.checkList),this.active++)},async fithStep(){try{this.$message.info("正在生成合同，请稍等...");let t={name:this.user.name,area:this.checkList[0].area,priceArea:this.checkList[0].priceArea,priceElse:c(this.multipleSelection),price:this.checkList[0].deposit,idcard:this.user.idcard,address:this.user.address,phone:this.user.phone};const{data:e}=await(0,k.mm)(t);this.pdfSrc=`${_.Z}/view/Contract/${e}`,this.localSrc=e,this.active++}catch(t){console.log(t)}},backContract(){this.signVisible=!1},async writeSign(t){try{this.$message.info("正在处理合同，请稍等...");let e={area:this.checkList[0].area,priceArea:this.checkList[0].priceArea,priceElse:c(this.multipleSelection),price:this.checkList[0].price,...this.user};this.total=this.checkList[0].price;const s=new FormData;s.append("file",t),s.append("param",JSON.stringify(e)),s.append("url",this.localSrc);const{data:a}=await(0,k.ij)(s);this.pdfSrc=`${_.Z}/view/Contract/${a}`;let i={houseId:this.checkList[0].houseId,userId:this.user.userId,deposit:this.checkList[0].deposit};const r=await v({...i,basicList:u(this.multipleSelection)});this.$message.success("签署成功"),this.rentId=r.data;const{data:l}=await(0,D.gZ)({rentId:this.rentId,total:this.checkList[0].price,userId:this.$store.getters.userId,type:"押金"});this.order=l,this.payTitle=`待支付：￥${this.order.total}`,this.signVisible=!1,this.contractShow=!1}catch(e){console.log(e)}},async sixth(){this.active=6},async alipay(){this.judgePay();try{const{data:t}=await(0,D.Gh)({...this.order,subject:"押金"}),e=window.open("","_target");e.document.write(t),e.focus()}catch(t){console.log(t)}},cashpay(){this.judgePay(),this.$confirm("确定收款成功, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(0,D.bD)({...this.order}),this.active=8}))},async judgePay(){try{const{data:t}=await(0,D.v6)(this.order);t>0&&(this.$message.success("支付成功"),this.payTitle=`已支付：￥${this.order.total}`,this.active=8)}catch(t){console.log(t)}},flash(){this.reload()}},computed:{isAdd(){return S.kL(this.$route.params.type)},isDel(){return S.bK(this.$route.params.type)},isUp(){return S.EN(this.$route.params.type)},isPull(){return S.kX(this.$route.params.type)},isEdit(){return S.mi(this.$route.params.type)},isGet(){return S.Xu(this.$route.params.type)}}},$=x,U=s(1001),F=(0,U.Z)($,l,o,!1,null,"27544a7b",null),N=F.exports,I=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"bg",staticStyle:{"padding-top":"5px"}},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 租客信息",column:3}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"small",disabled:t.isEdit||t.isOut},on:{click:t.updateIdcard}},[t._v("操作")])],1),e("el-descriptions-item",{attrs:{label:"账号"}},[t._v(t._s(t.user.username))]),e("el-descriptions-item",{attrs:{label:"姓名"}},[t._v(t._s(t.user.name))]),e("el-descriptions-item",{attrs:{label:"性别"}},[t._v(t._s(t.user.sex))]),e("el-descriptions-item",{attrs:{label:"民族"}},[t._v(t._s(t.user.nation))]),e("el-descriptions-item",{attrs:{label:"生日"}},[t._v(t._s(t.user.birthday))]),e("el-descriptions-item",{attrs:{label:"身份证"}},[t._v(t._s(t.user.idcard))]),e("el-descriptions-item",{attrs:{label:"手机号"}},[t._v(t._s(t.user.phone))]),e("el-descriptions-item",{attrs:{label:"签订时间"}},[t._v(t._s(t.user.sign))]),e("el-descriptions-item",{attrs:{label:"过期时间"}},[t._v(t._s(t.user.lose))]),e("el-descriptions-item",{attrs:{label:"签订机构"}},[t._v(t._s(t.user.authority))]),e("el-descriptions-item",{attrs:{label:"地址"}},[t._v(t._s(t.user.address))])],2)],1)]),e("div",{staticClass:"bg"},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 租房信息",column:3}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"small",disabled:t.isEdit||t.isOut},on:{click:t.updateHouse}},[t._v("操作")])],1),e("el-descriptions-item",{attrs:{label:"房号"}},[t._v(t._s(t.user.houseName))]),e("el-descriptions-item",{attrs:{label:"房型"}},[t._v(t._s(t.user.styleName))]),e("el-descriptions-item",{attrs:{label:"面积(㎡)"}},[t._v(t._s(t.user.area))]),e("el-descriptions-item",{attrs:{label:"阳台"}},[t._v(t._s(t.user.balcony))]),e("el-descriptions-item",{attrs:{label:"租金(月/元)"}},[t._v(t._s(t.user.price))]),e("el-descriptions-item",{attrs:{label:"登记时间"}},[t._v(t._s(t.user.loginRent))]),e("el-descriptions-item",{attrs:{label:"离开时间"}},[t._v(t._s(t.user.logoutRent))])],2)],1)]),e("div",{staticClass:"bg"},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 杂费信息"}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"small",disabled:t.isEdit||t.isOut},on:{click:t.updateBasic}},[t._v("操作")])],1)],2),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",height:"250",size:"small"},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费详情",width:"280"}}),e("el-table-column",{attrs:{prop:"time",label:"录入时间"}})],1)],1)])])},z=[],L={props:{user:{type:Object,default:()=>({})},tableData:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!0},isDel:{type:Boolean,default:!0},isOut:{type:Boolean,default:!0}},methods:{updateIdcard(){this.$emit("updateIdcard",this.user)},updateHouse(){this.$emit("updateHouse",this.user)},updateBasic(){this.$emit("updateBasic",this.user)}}},B=L,H=(0,U.Z)(B,I,z,!1,null,"8f97cf38",null),A=H.exports,P=s(2249),E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"form"},[e("el-form",{staticClass:"demo-form-inline",staticStyle:{"padding-right":"0"},attrs:{inline:!0,model:t.houseForm,size:"small"}},[e("el-row",[e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"房型"}},[e("el-select",{attrs:{placeholder:"请选择房型"},model:{value:t.houseForm.styleName,callback:function(e){t.$set(t.houseForm,"styleName",e)},expression:"houseForm.styleName"}},t._l(t.styleList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.styleName,value:t.styleName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"楼层"}},[e("el-select",{attrs:{placeholder:"请选择楼层"},model:{value:t.houseForm.floor,callback:function(e){t.$set(t.houseForm,"floor",e)},expression:"houseForm.floor"}},t._l(t.floorList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.floorName,value:t.floorName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"阳台"}},[e("el-select",{attrs:{placeholder:"请选择阳台"},model:{value:t.houseForm.balcony,callback:function(e){t.$set(t.houseForm,"balcony",e)},expression:"houseForm.balcony"}},[e("el-option",{attrs:{label:"有",value:"有"}}),e("el-option",{attrs:{label:"无",value:"无"}})],1)],1)],1),e("el-col",{attrs:{span:3}},[e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.getHouse}},[t._v("查询")])],1)],1)],1)],1)],1),e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请选择房间：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":"",height:"450",size:"mini",border:""},on:{"row-click":t.singleElection},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}])},[e("el-table-column",{attrs:{width:"55",label:"选择"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-radio",{staticClass:"radio",attrs:{label:s.row.houseId},model:{value:t.templateSelection,callback:function(e){t.templateSelection=e},expression:"templateSelection"}},[t._v(" ")])]}}])}),e("el-table-column",{attrs:{prop:"houseName",label:"房号",width:"80"}}),e("el-table-column",{attrs:{prop:"styleName",label:"房型"}}),e("el-table-column",{attrs:{prop:"balcony",label:"阳台",width:"80"}}),e("el-table-column",{attrs:{prop:"area",label:"面积(㎡)",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"房屋租金(月/元)",width:"120"}})],1)],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)])},j=[],T={props:{user:{type:Object,default:()=>({})}},data(){return{houseForm:{styleName:"",floor:"",balcony:""},tableData:[],templateSelection:"",checkList:[],floorList:[],styleList:[],newUser:{}}},created(){this.getAll()},methods:{async getAll(){try{const{data:t}=await(0,m.W)();this.floorList=t;const{data:e}=await(0,b.zs)();this.styleList=e,this.getHouse()}catch(t){console.log(t)}},async getHouse(){try{const{data:t}=await(0,y.YZ)(this.houseForm);this.tableData=t,this.resetHouse()}catch(t){console.log(t)}},resetHouse(){this.houseForm={styleName:"",floor:"",balcony:""}},singleElection(t){this.templateSelection=t.houseId,this.checkList=this.tableData.filter((e=>e.houseId===t.houseId))},submit(){0===this.checkList.length?this.$message.error("请选择房间，再进行下一步"):(console.log(this.checkList),this.$emit("changeUpdateHouseComponent",{houseData:this.checkList,component:"UpdateContract"}))},close(){this.newUser=this.user,this.$emit("afterUpdateHouse",this.newUser)}}},Z=T,R=(0,U.Z)(Z,E,j,!1,null,"53b5a1c8",null),O=R.exports,G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请签署合同：")]),e("iframe",{staticStyle:{width:"100%",height:"500px"},attrs:{frameborder:"0",src:t.pdfSrc}}),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.innerDrawer=!0}}},[t._v("确 定")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"电子签名",wrapperClosable:!1,"show-close":!1,"append-to-body":!0,"destroy-on-close":!0,size:"50%",visible:t.innerDrawer},on:{"update:visible":function(e){t.innerDrawer=e}}},[e("div",{staticStyle:{padding:"30px"}},[e("sign-canvas",{on:{back:t.backContract,commitSign:t.writeSign}})],1)])],1)])},M=[],K={components:{SignCanvas:C.Z},props:{user:{type:Object,default:()=>({})},house:{type:Array,default:()=>[]},miscellaneous:{type:Array,default:()=>[]}},data(){return{pdfSrc:"",newUser:{},newCheckList:[],localSrc:"",innerDrawer:!1}},created(){this.writeRentContract()},methods:{close(){this.newUser=this.user,this.$emit("afterUpdateHouse",this.newUser)},async writeRentContract(){try{console.log(this.miscellaneous),console.log(this.user),console.log(this.house),this.newCheckList=n(this.miscellaneous,this.house);let t={name:this.user.name,area:this.newCheckList[0].area,priceArea:this.newCheckList[0].priceArea,priceElse:c(this.miscellaneous),price:this.newCheckList[0].deposit,idcard:this.user.idcard,address:this.user.address,phone:this.user.phone};console.log(t);const{data:e}=await(0,k.mm)(t);this.pdfSrc=`${_.Z}/view/Contract/${e}`,this.localSrc=e,console.log(e)}catch(t){console.log(t)}},backContract(){this.innerDrawer=!1},async writeSign(t){try{console.log(t);let e={area:this.newCheckList[0].area,priceArea:this.newCheckList[0].priceArea,priceElse:c(this.miscellaneous),price:this.newCheckList[0].deposit,...this.user};await(0,k.EF)({userId:this.user.userId});const s=new FormData;s.append("file",t),s.append("param",JSON.stringify(e)),s.append("url",this.localSrc);const{data:a}=await(0,k.ij)(s);this.pdfSrc=`${_.Z}/view/Contract/${a}`;let i={houseId:this.newCheckList[0].houseId,userId:this.user.userId,deposit:this.newCheckList[0].deposit,oldHouseId:this.user.houseId,rentId:this.user.rentId};await w(i),this.$message.success("修改成功"),this.newUser={...this.user,...house}}catch(e){console.log(e)}finally{this.$emit("afterUpdateHouse",this.newUser)}}}},V=K,Y=(0,U.Z)(V,G,M,!1,null,"1f96c2bc",null),J=Y.exports,X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("已选择杂费：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",height:"250",size:"small",border:""},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"100"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"100"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费详情"}}),e("el-table-column",{attrs:{prop:"time",label:"录入时间"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text",size:"mini",disabled:t.isDel},on:{click:function(e){return t.deleteRow(s.row)}}},[t._v(" 删除 ")])]}}])})],1)],1),e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("待选择杂费:")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.noBasicData,stripe:"",height:"250",size:"small",border:""},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费详情"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{type:"text",size:"mini",disabled:t.isAdd},on:{click:function(e){return t.addRow(s.row)}}},[t._v(" 添加 ")])]}}])})],1)],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.close}},[t._v("完成")])],1)])},W=[],Q={props:{user:{type:Object,default:()=>({})},tableData:{type:Array,default:()=>[]},isDel:{type:Boolean,default:!0},isAdd:{type:Boolean,default:!0}},created(){this.getNoBasic()},data(){return{newTableData:[],noBasicData:[]}},methods:{async getNoBasic(){try{const{data:t}=await(0,h.hU)({rentId:this.user.rentId});console.log(t),this.noBasicData=t}catch(t){console.log(t)}},async deleteRow(t){this.$confirm("此操作将永久删除该杂费, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await(0,h.Q$)({state:2,miscellaneousId:t.miscellaneousId}),this.$message.success("删除成功")}catch(e){console.log(e)}finally{this.$emit("deleteMiscellaneous"),this.getNoBasic()}})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},async addRow(t){this.$confirm("此操作将添加该杂费, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await(0,h.Cj)({rentId:this.user.rentId,baseId:t.baseId}),this.$message.success("添加成功")}catch(e){console.log(e)}finally{this.$emit("deleteMiscellaneous"),this.getNoBasic()}})).catch((()=>{this.$message({type:"info",message:"已取消添加"})}))},close(){this.newTableData=this.tableData,this.$emit("afterUpdateBasic",this.newTableData)}}},q=Q,tt=(0,U.Z)(q,X,W,!1,null,"06e95ae6",null),et=tt.exports,st=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[0==t.active?e("div",[e("div",{staticClass:"form"},[e("el-form",{staticClass:"demo-form-inline",staticStyle:{"padding-right":"0"},attrs:{inline:!0,model:t.houseForm,size:"small"}},[e("el-row",[e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"房型"}},[e("el-select",{attrs:{placeholder:"请选择房型"},model:{value:t.houseForm.styleName,callback:function(e){t.$set(t.houseForm,"styleName",e)},expression:"houseForm.styleName"}},t._l(t.styleList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.styleName,value:t.styleName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"楼层"}},[e("el-select",{attrs:{placeholder:"请选择楼层"},model:{value:t.houseForm.floor,callback:function(e){t.$set(t.houseForm,"floor",e)},expression:"houseForm.floor"}},t._l(t.floorList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.floorName,value:t.floorName}})})),1)],1)],1),e("el-col",{attrs:{span:7}},[e("el-form-item",{attrs:{label:"阳台"}},[e("el-select",{attrs:{placeholder:"请选择阳台"},model:{value:t.houseForm.balcony,callback:function(e){t.$set(t.houseForm,"balcony",e)},expression:"houseForm.balcony"}},[e("el-option",{attrs:{label:"有",value:"有"}}),e("el-option",{attrs:{label:"无",value:"无"}})],1)],1)],1),e("el-col",{attrs:{span:3}},[e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.getHouse}},[t._v("查询")])],1)],1)],1)],1)],1),e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请选择房间：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"highlight-current-row":"",height:"450",size:"mini",border:""},on:{"row-click":t.singleElection},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}],null,!1,524701319)},[e("el-table-column",{attrs:{width:"55",label:"选择"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-radio",{staticClass:"radio",attrs:{label:s.row.houseId},model:{value:t.templateSelection,callback:function(e){t.templateSelection=e},expression:"templateSelection"}},[t._v(" ")])]}}],null,!1,3666378396)}),e("el-table-column",{attrs:{prop:"houseName",label:"房号",width:"80"}}),e("el-table-column",{attrs:{prop:"styleName",label:"房型"}}),e("el-table-column",{attrs:{prop:"balcony",label:"阳台",width:"80"}}),e("el-table-column",{attrs:{prop:"area",label:"面积(㎡)",width:"80"}}),e("el-table-column",{attrs:{prop:"price",label:"房屋租金(月/元)",width:"120"}})],1)],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submit1}},[t._v("确 定")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)]):t._e(),1==t.active?e("div",[e("div",{staticClass:"table"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请选择杂费：")]),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.baseData,"tooltip-effect":"dark",height:"438",size:"mini",border:"","row-key":t.getRowKey},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55","reserve-selection":!0}}),e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费说明"}})],1)],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submit2}},[t._v("确 定")]),e("el-button",{on:{click:function(e){t.active--}}},[t._v("上一步")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)]):t._e(),2==t.active?e("div",[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("已选择房间：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.checkList,"highlight-current-row":"",size:"mini",border:""},on:{"row-click":t.singleElection}},[e("el-table-column",{attrs:{prop:"houseName",label:"房号",width:"60"}}),e("el-table-column",{attrs:{prop:"styleName",label:"房型"}}),e("el-table-column",{attrs:{prop:"balcony",label:"阳台",width:"60"}}),e("el-table-column",{attrs:{prop:"area",label:"面积(㎡)",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"房屋租金(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"deposit",label:"总租金(月/元)",width:"120"}})],1),e("p",{staticStyle:{color:"#303133","font-size":"14px","margin-top":"15px"}},[t._v("已选择杂费：")]),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.multipleSelection,"highlight-current-row":"",size:"mini",height:"300",border:""},on:{"row-click":t.singleElection}},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称",width:"120"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费说明"}})],1),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:t.submit3}},[t._v("确 定")]),e("el-button",{on:{click:t.back}},[t._v("上一步")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)],1):t._e(),3==t.active?e("div",[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("请签署合同：")]),e("iframe",{staticStyle:{width:"100%",height:"500px"},attrs:{frameborder:"0",src:t.pdfSrc}}),e("div",{staticClass:"btn"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.innerDrawer=!0}}},[t._v("确 定")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"电子签名",wrapperClosable:!1,"show-close":!1,"append-to-body":!0,"destroy-on-close":!0,size:"50%",visible:t.innerDrawer},on:{"update:visible":function(e){t.innerDrawer=e}}},[e("div",{staticStyle:{padding:"30px"}},[e("sign-canvas",{on:{back:t.backContract,commitSign:t.writeSign}})],1)])],1)]):t._e(),4==t.active?e("div",[e("pay",{attrs:{order:t.order},on:{closePayDrawer:t.close}})],1):t._e()])},at=[],it=s(2129),rt={components:{SignCanvas:C.Z,Pay:it.Z},props:{user:{type:Object,default:()=>({})}},data(){return{houseForm:{styleName:"",floor:"",balcony:""},tableData:[],templateSelection:"",checkList:[],floorList:[],styleList:[],active:0,baseData:[],multipleSelection:[],pdfSrc:"",innerDrawer:!1,order:{},total:""}},created(){this.getAll()},methods:{async getAll(){try{const{data:t}=await(0,m.W)();this.floorList=t;const{data:e}=await(0,b.zs)();this.styleList=e,this.getHouse()}catch(t){console.log(t)}},async getHouse(){try{const{data:t}=await(0,y.YZ)(this.houseForm);this.tableData=t,this.resetHouse()}catch(t){console.log(t)}},resetHouse(){this.houseForm={styleName:"",floor:"",balcony:""}},singleElection(t){this.templateSelection=t.houseId,this.checkList=this.tableData.filter((e=>e.houseId===t.houseId))},async submit1(){if(0===this.checkList.length)this.$message.error("请选择房间，再进行下一步");else{const{data:t}=await(0,h.FE)();this.baseData=t,this.active++}},getRowKey(t){return t.baseId},handleSelectionChange(t){this.multipleSelection=t},submit2(){0==this.multipleSelection.length?this.$confirm("没有选择房屋杂费, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.checkList=n(this.multipleSelection,this.checkList),this.active++})):(this.checkList=n(this.multipleSelection,this.checkList),this.active++)},submit3(){this.writeRentContract(),this.active++},async writeRentContract(){try{this.$message.info("正在生成合同，请稍等...");let t={name:this.user.name,area:this.checkList[0].area,priceArea:this.checkList[0].priceArea,priceElse:c(this.multipleSelection),price:this.checkList[0].deposit,idcard:this.user.idcard,address:this.user.address,phone:this.user.phone};console.log(t);const{data:e}=await(0,k.mm)(t);this.pdfSrc=`${_.Z}/view/Contract/${e}`,this.localSrc=e,console.log(e)}catch(t){console.log(t)}},backContract(){this.innerDrawer=!1},async writeSign(t){try{this.$message.info("正在处理合同，请稍等...");let e={...this.user,area:this.checkList[0].area,priceArea:this.checkList[0].priceArea,priceElse:c(this.multipleSelection),price:this.checkList[0].price};this.total=this.checkList[0].price;const s=new FormData;s.append("file",t),s.append("param",JSON.stringify(e)),s.append("url",this.localSrc);const{data:a}=await(0,k.ij)(s);this.pdfSrc=`${_.Z}/view/Contract/${a}`;let i={houseId:this.checkList[0].houseId,userId:this.user.userId,deposit:this.checkList[0].deposit};const r=await v({...i,basicList:u(this.multipleSelection)});this.$message.success("签署成功"),this.rentId=r.data;const{data:l}=await(0,D.gZ)({rentId:this.rentId,total:this.checkList[0].price,userId:this.$store.getters.userId,type:"押金"});this.order=l,this.active++}catch(e){console.log(e)}},close(){this.$emit("closeAddHouseDrawer")},back(){this.multipleSelection=[],this.active--}}},lt=rt,ot=(0,U.Z)(lt,st,at,!1,null,"ae466ee6",null),nt=ot.exports,ct={components:{CreateUser:N,DrawerUserDetail:A,UpdateUser:P.Z,UpdateHouse:O,UpdateContract:J,UpdateBasic:et,LoginHouse:nt,Pay:it.Z},data(){return{defaultImg:s(7239),isCurrent:"in",targetUrl:_.Z,searchForm:{name:"",username:"",houseName:""},tableData:[],pagination:{currentPage:1,pageSize:6,total:0},drawer:!1,miscellaneousData:[],user:{},idcardDrawer:!1,houseDrawer:!1,updateHouseComponent:"UpdateHouse",houseData:[],basicDrawer:!1,addHouseDrawer:!1,payDrawer:!1,order:{},obj:{}}},async created(){await this.changeCurrent("in")},methods:{reset(){this.pagination={currentPage:1,pageSize:8,total:0},this.searchForm={name:"",username:"",houseName:""}},async changeCurrent(t){this.isCurrent=t,this.reset()},handleCurrentChange(t){this.pagination.currentPage=t,"house"==this.isCurrent?this.getNoHouseUserPage():this.getUserPage()},async getUserPage(){try{const t=`${this.pagination.currentPage}/${this.pagination.pageSize}`,{data:e}=await(0,r.HF)(t,{...this.searchForm,...this.obj});this.tableData=e.records,this.pagination.currentPage=e.current,this.pagination.total=e.total,this.pagination.pageSize=e.size}catch(t){console.log(t)}},async getNoHouseUserPage(){try{const t=`${this.pagination.currentPage}/${this.pagination.pageSize}`,{data:e}=await(0,r.xk)(t,this.searchForm);this.tableData=e.records,this.pagination.currentPage=e.current,this.pagination.total=e.total,this.pagination.pageSize=e.size}catch(t){console.log(t)}},search(){"in"!=this.isCurrent&&"out"!=this.isCurrent&&"pay"!=this.isCurrent||this.getUserPage(),"house"==this.isCurrent&&this.getNoHouseUserPage()},openDrawer(t){this.user=t,this.getBasicByUserId(t),this.drawer=!0},async getBasicByUserId(t){try{const{data:e}=await(0,h.oC)({userId:t.userId});this.miscellaneousData=e}catch(e){console.log(e)}},deleteMiscellaneous(){this.getBasicByUserId(this.user)},updateIdcard(t){this.user=t,this.idcardDrawer=!0},updateUser(t){this.user=t,this.getUserPage(),this.idcardDrawer=!1},updateHouse(t){console.log(t),this.user=t,this.houseDrawer=!0},afterUpdateHouse(t){console.log(t),this.updateHouseComponent="UpdateHouse",this.houseData={},this.user=t,this.getUserPage(),this.houseDrawer=!1},changeUpdateHouseComponent(t){console.log(t),this.updateHouseComponent=t.component,this.houseData=t.houseData},updateBasic(t){this.user=t,this.basicDrawer=!0},afterUpdateBasic(t){this.miscellaneousData=t,this.basicDrawer=!1},deleteUser(t){this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{console.log(t),await(0,r.r_)({state:2,userId:t.userId}),this.$message.success("删除成功")}catch(e){console.log(e)}finally{this.getNoHouseUserPage()}})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},openAddHouseDrawer(t){this.user=t,this.addHouseDrawer=!0},closeAddHouseDrawer(){this.addHouseDrawer=!1,this.getNoHouseUserPage()},async openPayDrawer(t){try{const{data:e}=await(0,D.IN)({rentId:t.rentId});this.order=e,this.payDrawer=!0}catch(e){console.log(e)}},closePayDrawer(){this.getUserPage(),this.payDrawer=!1}},watch:{isCurrent:{async handler(t,e){"in"==t&&(this.obj={state:1,orderState:""},await this.getUserPage()),"out"==t&&(this.obj={state:0,orderState:""},await this.getUserPage()),"pay"==t&&(this.obj={state:1,orderState:0},await this.getUserPage()),"house"==t&&await this.getNoHouseUserPage()},immediate:!0}},computed:{isAdd(){return S.kL(this.$route.params.type)},isDel(){return S.bK(this.$route.params.type)},isUp(){return S.EN(this.$route.params.type)},isPull(){return S.kX(this.$route.params.type)},isEdit(){return S.mi(this.$route.params.type)},isGet(){return S.Xu(this.$route.params.type)},isOut(){return"out"==this.isCurrent}}},ut=ct,dt=(0,U.Z)(ut,a,i,!1,null,"495902f2",null),pt=dt.exports},5364:function(t,e,s){s.d(e,{Cj:function(){return u},FE:function(){return l},Q$:function(){return n},Sh:function(){return h},hU:function(){return c},mZ:function(){return d},nx:function(){return p},oC:function(){return o},uX:function(){return i},wS:function(){return r}});var a=s(9312);function i(t){return(0,a.v_)("insertBasic",t)}function r(t,e){return(0,a.U2)(`getAllBasic/${t}`,e)}function l(){return(0,a.U2)("getBasic",{})}function o(t){return(0,a.U2)("getBasicByUserId",t)}function n(t){return(0,a.U2)("changeMiscellaneousState",t)}function c(t){return(0,a.U2)("getNoBasicByRentId",t)}function u(t){return(0,a.U2)("insertMiscellaneous",t)}function d(t){return(0,a.U2)("deleteBasic",t)}function p(t){return(0,a.v_)("updateBasic",t)}function h(t){return(0,a.U2)("getOrderMis",t)}},50:function(t,e,s){s.d(e,{W:function(){return r},b:function(){return i}});var a=s(9312);function i(t){return(0,a.U2)(`/getArea/${t}`,{})}function r(){return(0,a.U2)("/getFloor",{})}},5115:function(t,e,s){s.d(e,{AD:function(){return l},L$:function(){return r},Pe:function(){return i},YZ:function(){return o},gh:function(){return u},qb:function(){return n},y1:function(){return c}});var a=s(9312);function i(t){return(0,a.U2)(`/getHouseNumber/${t}`,{})}function r(t){return(0,a.v_)("/insertHouse",t)}function l(t){return(0,a.U2)(`/getHouseDetail/${t}`)}function o(t){return(0,a.U2)("/getHouse",t)}function n(t){return(0,a.U2)("deleteHouse",t)}function c(t){return(0,a.U2)("judgeHouseState",t)}function u(){return(0,a.U2)("getHouseNum",{})}},5532:function(t,e,s){s.d(e,{$K:function(){return u},CQ:function(){return i},KR:function(){return r},Oj:function(){return p},PG:function(){return c},Uz:function(){return n},YN:function(){return l},tn:function(){return o},x3:function(){return d},zs:function(){return h}});var a=s(9312);function i(t){return(0,a.v_)("/insertStyle",t)}function r(t,e){return(0,a.U2)(`/getAllStyle/${t}`,e)}function l(t){return(0,a.U2)(`/resetStyle/${t}/1`)}function o(t){return(0,a.U2)(`/resetStyle/${t}/0`)}function n(t){return(0,a.v_)("/updateStyle",t)}function c(t){return(0,a.U2)(`/getStyleName/${t}`,{})}function u(t,e){return(0,a.U2)(`/getStyleArea/${t}`,e)}function d(t,e){return(0,a.U2)(`/getStyleBalcony/${t}`,e)}function p(t,e){return(0,a.U2)(`/leftStyle/${t}`,e)}function h(){return(0,a.U2)("getAllStyleName",{})}},7535:function(t,e,s){s.d(e,{Gh:function(){return l},IN:function(){return n},_z:function(){return c},bD:function(){return r},gZ:function(){return i},v6:function(){return o}});var a=s(9312);function i(t){return(0,a.U2)("generateOrder",t)}function r(t){return(0,a.v_)("payByCash",t)}function l(t){return(0,a.v_)("payByAlipay",t)}function o(t){return(0,a.U2)("judgePay",t)}function n(t){return(0,a.U2)("getOrderByRentId",t)}function c(t,e){return(0,a.U2)(`getAllOrder/${t}`,e)}}}]);
//# sourceMappingURL=129.f6d0cc33.js.map