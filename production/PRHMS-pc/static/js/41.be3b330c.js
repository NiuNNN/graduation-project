"use strict";(self["webpackChunkpc_web"]=self["webpackChunkpc_web"]||[]).push([[41],{6494:function(t,e,s){s.r(e),s.d(e,{default:function(){return S}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-container"},[t._m(0),e("div",[e("create-user")],1),e("div",{staticClass:"bg"},[e("div",{staticClass:"navbar"},[e("span",{class:{current:"in"==t.isCurrent},on:{click:function(e){return t.changeCurrent("in")}}},[t._v("已 入 职 员 工")]),e("span",{class:{current:"out"==t.isCurrent},on:{click:function(e){return t.changeCurrent("out")}}},[t._v("已 离 职 员 工")])]),e("div",{staticClass:"table"},[e("div",{staticClass:"top"},[e("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.searchForm,"label-width":"50px"}},[e("el-form-item",{attrs:{label:"姓名"}},[e("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name",e)},expression:"searchForm.name"}})],1),e("el-form-item",{attrs:{label:"账号"}},[e("el-input",{attrs:{placeholder:"请输入账号"},model:{value:t.searchForm.username,callback:function(e){t.$set(t.searchForm,"username",e)},expression:"searchForm.username"}})],1),e("el-form-item",{attrs:{label:"职位:",prop:"roleId"}},[e("el-select",{attrs:{placeholder:"请选择职位"},model:{value:t.searchForm.roleId,callback:function(e){t.$set(t.searchForm,"roleId",e)},expression:"searchForm.roleId"}},t._l(t.roleList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.roleName,value:t.roleId}})})),1)],1),e("el-form-item",[e("el-button",{staticStyle:{height:"35px"},attrs:{type:"primary",disabled:t.isGet},on:{click:t.search}},[t._v("查询")])],1)],1)],1),e("div",{staticClass:"bottom"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":200}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"name",label:"头像",width:"100"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-avatar",{directives:[{name:"imageerror",rawName:"v-imageerror",value:t.defaultImg,expression:"defaultImg"}],attrs:{src:`${t.targetUrl}/view/Avatar/${s.row.avatar}`}})]}}])}),e("el-table-column",{attrs:{prop:"username",label:"账号"}}),e("el-table-column",{attrs:{prop:"name",label:"姓名",width:"100"}}),e("el-table-column",{attrs:{prop:"roleName",label:"职位",width:"100"}}),e("el-table-column",{attrs:{prop:"phone",label:"手机"}}),e("el-table-column",{attrs:{prop:"idcard",label:"身份证"}}),e("el-table-column",{attrs:{prop:"addtime",label:"添加时间"}}),e("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",disabled:t.isGet,type:"primary"},on:{click:function(e){return t.openDrawer(s.row)}}},[t._v("查看")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{"current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,background:"",layout:"prev, pager, next",total:t.pagination.total},on:{"current-change":t.handleCurrentChange}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:"员工详细信息",visible:t.drawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.drawer=e}}},[e("div",{staticClass:"drawer-bg"},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 员工信息",column:3}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"small",disabled:t.isEdit||t.isOut},on:{click:t.updateIdcard}},[t._v("操作")])],1),e("el-descriptions-item",{attrs:{label:"账号"}},[t._v(t._s(t.user.username))]),e("el-descriptions-item",{attrs:{label:"姓名"}},[t._v(t._s(t.user.name))]),e("el-descriptions-item",{attrs:{label:"性别"}},[t._v(t._s(t.user.sex))]),e("el-descriptions-item",{attrs:{label:"民族"}},[t._v(t._s(t.user.nation))]),e("el-descriptions-item",{attrs:{label:"生日"}},[t._v(t._s(t.user.birthday))]),e("el-descriptions-item",{attrs:{label:"身份证"}},[t._v(t._s(t.user.idcard))]),e("el-descriptions-item",{attrs:{label:"手机号"}},[t._v(t._s(t.user.phone))]),e("el-descriptions-item",{attrs:{label:"签订时间"}},[t._v(t._s(t.user.sign))]),e("el-descriptions-item",{attrs:{label:"过期时间"}},[t._v(t._s(t.user.lose))]),e("el-descriptions-item",{attrs:{label:"签订机构"}},[t._v(t._s(t.user.authority))]),e("el-descriptions-item",{attrs:{label:"地址"}},[t._v(t._s(t.user.address))])],2)],1)]),e("div",{staticClass:"drawer-bg"},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 职务信息",column:4}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"danger",size:"small",disabled:t.isDel||t.isOut},on:{click:t.leave}},[t._v("离职")])],1),e("el-descriptions-item",{attrs:{span:4,label:"职务"}},[t._v(t._s(t.user.roleName))]),e("el-descriptions-item",{attrs:{span:4,label:"工作详情"}},[t._v(t._s(t.user.roleRemark))]),e("el-descriptions-item",{attrs:{span:2,label:"入职时间"}},[t._v(t._s(t.user.addtime))]),e("el-descriptions-item",{attrs:{span:2,label:"离职时间"}},[t._v(t._s(t.user.deltime))]),t._l(t.userSalary,(function(s,a){return e("el-descriptions-item",{key:a,attrs:{label:s.salaryName}},[t._v(t._s(s.price))])}))],2)],1)])])],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{wrapperClosable:!1,"show-close":!1,title:"修改员工信息",visible:t.idcardDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.idcardDrawer=e}}},[e("update-user",{attrs:{user:t.user},on:{updateUser:t.updateUser}})],1)],1)])])])},r=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-container"},[e("h1",[t._v("员 工 管 理")])])}],i=s(2900),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg"},[e("div",{staticClass:"collapse-container"},[e("el-collapse",{staticStyle:{"border-top":"none"},attrs:{accordion:""},on:{change:t.getRole},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-collapse-item",{attrs:{name:"1"},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"collapse-title"},[e("span",[t._v("添 加 新 住 户")])])]},proxy:!0}])},[e("div",{staticClass:"bg-container"},[e("div",{staticClass:"insert"},[e("div",{staticClass:"top"},[e("el-steps",{attrs:{active:t.active,"finish-status":"success"}},[e("el-step",{attrs:{title:"上传员工信息"}}),e("el-step",{attrs:{title:"确认员工信息"}}),e("el-step",{attrs:{title:"签署合同"}}),e("el-step",{attrs:{title:"完成"}})],1)],1),0===t.active?e("div",[e("div",{staticClass:"middle"},[e("el-form",{ref:"userForm",staticClass:"demo-form-inline",attrs:{inline:!0,model:t.userForm,size:"small",rules:t.rules}},[e("el-row",[e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"电话:",prop:"phone"}},[e("el-input",{attrs:{placeholder:"请输入住户电话"},model:{value:t.userForm.phone,callback:function(e){t.$set(t.userForm,"phone",e)},expression:"userForm.phone"}})],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"职位:",prop:"roleId"}},[e("el-select",{attrs:{placeholder:"请选择职位"},model:{value:t.userForm.roleId,callback:function(e){t.$set(t.userForm,"roleId",e)},expression:"userForm.roleId"}},t._l(t.roleList,(function(t,s){return e("el-option",{key:s,attrs:{label:t.roleName,value:t.roleId}})})),1)],1)],1)],1)],1),e("div",{staticClass:"idcard"},[e("span",{staticClass:"idcard-header"},[e("i",{staticStyle:{color:"#ff2855","margin-right":"4px"}},[t._v("*")]),t._v("身份证照片")]),e("el-row",{staticStyle:{padding:"0 25px"},attrs:{gutter:20,justify:"space-between"}},[e("el-col",{attrs:{span:9}},[e("div",{class:[{error:t.isErrorFont},{idcard_container:!0}],on:{click:function(e){return t.uploadAvatar("font")}}},[e("input",{ref:"fontRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpeg"},on:{change:function(e){return t.onFileChange(e,"font")}}}),t.fontUrl?e("img",{attrs:{src:t.fontUrl,alt:""}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"},[t._v("带国徽面")])])]),e("el-col",{attrs:{span:9}},[e("div",{class:[{error:t.isErrorBack},{idcard_container:!0}],on:{click:function(e){return t.uploadAvatar("back")}}},[e("input",{ref:"backRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/jpeg"},on:{change:function(e){return t.onFileChange(e,"back")}}}),t.backUrl?e("img",{attrs:{src:t.backUrl,alt:""}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"},[t._v("带头像面")])])])],1)],1)],1),e("div",{staticClass:"bottom",staticStyle:{"margin-top":"60px"}},[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.firstStep}},[t._v("下一步")]),e("el-button",{on:{click:t.close}},[t._v("取 消")])],1)]):t._e(),1===t.active?e("div",[e("div",{staticClass:"middle"},[e("el-descriptions",{staticClass:"margin-top",attrs:{title:`账号：${t.user.username}`,column:3}},[e("el-descriptions-item",{attrs:{label:"姓名"}},[t._v(t._s(t.user.name))]),e("el-descriptions-item",{attrs:{label:"性别"}},[t._v(t._s(t.user.sex))]),e("el-descriptions-item",{attrs:{label:"民族"}},[t._v(t._s(t.user.nation))]),e("el-descriptions-item",{attrs:{label:"生日"}},[t._v(t._s(t.user.birthday))]),e("el-descriptions-item",{attrs:{label:"身份证"}},[t._v(t._s(t.user.idcard))]),e("el-descriptions-item",{attrs:{label:"手机号"}},[t._v(t._s(t.user.phone))]),e("el-descriptions-item",{attrs:{label:"签订时间"}},[t._v(t._s(t.user.sign))]),e("el-descriptions-item",{attrs:{label:"过期时间"}},[t._v(t._s(t.user.lose))]),e("el-descriptions-item",{attrs:{label:"签订机构"}},[t._v(t._s(t.user.authority))]),e("el-descriptions-item",{attrs:{label:"地址"}},[t._v(t._s(t.user.address))])],1),e("el-descriptions",{staticClass:"margin-top",attrs:{title:`职位：${t.roleName}`,column:3}},t._l(t.userSalary,(function(s,a){return e("el-descriptions-item",{key:a,attrs:{label:s.salaryName}},[t._v(t._s(s.price))])})),1)],1),e("div",{staticClass:"bottom"},[t.secondStepBtn?[e("el-button",{attrs:{type:"primary",disabled:!0}},[t._v("确认无误后，下一步("+t._s(t.second)+"s)")])]:[e("el-button",{attrs:{type:"primary",disabled:t.isAdd},on:{click:t.secondStep}},[t._v("下一步")])],e("el-button",{on:{click:function(e){return t.back()}}},[t._v("返 回")])],2)]):t._e(),2===t.active?e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("签署合同")]),e("iframe",{staticStyle:{width:"100%",height:"450px"},attrs:{frameborder:"0",src:t.pdfSrc}})]),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.signVisible=!0}}},[t._v("确 定")])],1),e("el-dialog",{attrs:{title:"电子签名",visible:t.signVisible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.signVisible=e}}},[e("sign-canvas",{on:{back:t.backContract,commitSign:t.writeSign}})],1)],1):t._e(),3===t.active?e("div",[e("div",{staticClass:"middle"},[e("p",{staticStyle:{color:"#303133","font-size":"14px"}},[t._v("合同签署完毕")]),e("iframe",{staticStyle:{width:"100%",height:"450px"},attrs:{frameborder:"0",src:t.pdfSrc}})]),e("div",{staticClass:"bottom"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){t.active=4}}},[t._v("确 定")])],1)]):t._e(),4===t.active?e("div",[e("el-result",{attrs:{icon:"success",title:"员工录用成功",subTitle:"3秒后刷新页面"}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.flash}},[t._v("确定")])],1)],2)],1):t._e()])])])],1)],1)])},l=[],o=s(9176),c=s(7278),u=s(3811),d=s(6585),p=s(6134),m=s(730),h={inject:["reload"],components:{SignCanvas:p.Z},data(){const t=(t,e,s)=>{(0,o.Lp)(e)?s():s(new Error("请输入正确的手机号"))};return{activeName:"",active:0,userForm:{phone:"",roleId:"",username:""},fontUrl:"",backUrl:"",fontFile:"",backFile:"",roleList:[],isErrorFont:!1,isErrorBack:!1,rules:{phone:[{required:!0,trigger:"blur",message:"请输入住户手机"},{trigger:"blur",validator:t}],roleId:[{required:!0,trigger:"change",message:"请选择职位"}]},isfont:!1,isback:!1,firstStepBtn:!1,user:{},userSalary:[],secondStepBtn:!0,second:3,roleName:"",timer:null,pdfSrc:"",signVisible:!1,localSrc:""}},methods:{back(){this.active--,this.second=3,clearInterval(this.timer)},close(){this.activeName="",this.userForm.phone="",this.fontUrl="",this.backUrl="",this.fontFile="",this.backFile=""},async getRole(){try{const{data:t}=await(0,m.cY)();this.roleList=t}catch(t){console.log(t)}},uploadAvatar(t){"font"===t&&this.$refs.fontRef.click(),"back"===t&&this.$refs.backRef.click()},onFileChange(t,e){const s=t.target.files;if(0!==s.length&&this.beforeAvatarUpload(s[0])){const t=new FileReader;t.readAsDataURL(s[0]),t.onload=async t=>{try{"font"===e&&(this.isfont=!1,this.fontUrl=t.target.result,this.fontFile=s[0],this.isErrorFont=!0),"back"===e&&(this.isback=!1,this.backUrl=t.target.result,this.backFile=s[0],this.isErrorBack=!0);const a=new FormData;a.append("file",s[0]),a.append("direction",e);const{data:r}=await(0,i.RA)(a);"font"===r&&(this.isErrorFont=!1,this.isfont=!0),"back"===r&&(this.isErrorBack=!1,this.isback=!0),this.$message.success("校验通过")}catch(a){console.log(a)}}}},beforeAvatarUpload(t){const e="image/jpeg"===t.type,s=t.size/1024/1024<2;return e||this.$message.error("上传头像图片只能是 JPG 格式!"),s||this.$message.error("上传头像图片大小不能超过 2MB!"),e&&s},firstStep(){this.firstStepBtn=!0,this.$refs.userForm.validate((async t=>{if(t)if(this.isfont&&this.isback)try{const t=new FormData;t.append("font",this.fontFile),t.append("back",this.backFile);const{data:e}=await(0,i.mt)(t),{data:s}=await(0,i.Zg)({roleId:this.userForm.roleId}),{data:a}=await(0,m.L9)({roleId:this.userForm.roleId});this.roleName=a[0].roleName,this.userSalary=a,this.user={...e,...this.userForm,username:s},this.active++,this.countTimeOut()}catch(e){console.log(e)}finally{this.firstStepBtn=!1}else this.firstStepBtn=!1,this.$message.error("请上传对应的证件");else this.firstStepBtn=!1}))},countTimeOut(){this.timer=setInterval((()=>{this.second--,0==this.second&&(this.second=10,this.secondStepBtn=!1,clearInterval(this.timer))}),1e3)},async secondStep(){try{const t=new FormData;t.append("font",this.fontFile),t.append("back",this.backFile),t.append("user",JSON.stringify(this.user)),t.append("roleId",JSON.stringify(this.userForm.roleId));const{data:e}=await(0,i._Y)(t);this.user=e,this.$message.info("创建成功,正在生成合同，请稍等..."),await this.generateContract(),this.active++}catch(t){console.log(t)}},async generateContract(){try{let t={price:this.userSalary[0].price,priceElse:this.userSalary[1].price,...this.user};const{data:e}=await(0,u.Te)(t);this.pdfSrc=`${c.Z}/view/Contract/${e}`,this.localSrc=e}catch(t){console.log(t)}},backContract(){this.signVisible=!1},async writeSign(t){try{this.$message.info("正在处理合同，请稍等...");let e={price:this.userSalary[0].price,priceElse:this.userSalary[1].price,...this.user};const s=new FormData;s.append("file",t),s.append("param",JSON.stringify(e)),s.append("url",this.localSrc);const{data:a}=await(0,u.WD)(s);this.pdfSrc=`${c.Z}/view/Contract/${a}`,this.$message.success("签署成功"),this.signVisible=!1,this.active++}catch(e){console.log(e)}},flash(){this.reload()}},computed:{isAdd(){return d.kL(this.$route.params.type)},isDel(){return d.bK(this.$route.params.type)},isUp(){return d.EN(this.$route.params.type)},isPull(){return d.kX(this.$route.params.type)},isEdit(){return d.mi(this.$route.params.type)},isGet(){return d.Xu(this.$route.params.type)}}},f=h,v=s(1001),b=(0,v.Z)(f,n,l,!1,null,"5109ada6",null),g=b.exports,y=s(2249),_={components:{CreateUser:g,UpdateUser:y.Z},data(){return{defaultImg:s(7239),isCurrent:"in",targetUrl:c.Z,searchForm:{name:"",username:"",roleId:""},tableData:[],pagination:{currentPage:1,pageSize:6,total:0},user:{},roleList:[],obj:{},drawer:!1,userSalary:[],idcardDrawer:!1}},async created(){await this.getRole(),await this.getStaffPage()},methods:{async getRole(){try{const{data:t}=await(0,m.cY)();this.roleList=t}catch(t){console.log(t)}},reset(){this.pagination={currentPage:1,pageSize:8,total:0},this.searchForm={name:"",username:"",roleId:""}},async changeCurrent(t){this.isCurrent=t,this.reset()},async handleCurrentChange(t){this.pagination.currentPage=t,await this.getStaffPage()},async search(){await this.getStaffPage(),this.searchForm={name:"",username:"",roleId:""}},updateUser(t){this.user=t,this.getStaffPage(),this.idcardDrawer=!1},async getStaffPage(){try{const t=`${this.pagination.currentPage}/${this.pagination.pageSize}`,{data:e}=await(0,i.R0)(t,{...this.searchForm,...this.obj});this.tableData=e.records,this.pagination.currentPage=e.current,this.pagination.total=e.total,this.pagination.pageSize=e.size}catch(t){console.log(t)}},async openDrawer(t){try{this.user=t;const{data:e}=await(0,m.L9)({roleId:t.roleId});this.userSalary=e,this.drawer=!0}catch(e){console.log(e)}},updateIdcard(){this.idcardDrawer=!0},leave(){this.$prompt("请输入密码","员工离职",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"password",inputPattern:/^\w{5,12}$/,inputErrorMessage:"密码格式不正确"}).then((async({value:t})=>{try{await(0,i.uo)({password:t,username:this.$store.getters.username}),await(0,m.nA)(this.user),this.$message.success("员工离职成功..."),this.drawer=!1}catch(e){console.log(e)}finally{this.getStaffPage()}})).catch((()=>{this.$message({type:"info",message:"取消编辑"})}))}},computed:{isAdd(){return d.kL(this.$route.params.type)},isDel(){return d.bK(this.$route.params.type)},isUp(){return d.EN(this.$route.params.type)},isPull(){return d.kX(this.$route.params.type)},isEdit(){return d.mi(this.$route.params.type)},isGet(){return d.Xu(this.$route.params.type)},isOut(){return"out"==this.isCurrent}},watch:{isCurrent:{async handler(t,e){"in"==t&&(this.obj={state:1}),"out"==t&&(this.obj={state:0}),await this.getStaffPage()},immediate:!0}}},k=_,w=(0,v.Z)(k,a,r,!1,null,"0e347471",null),S=w.exports},730:function(t,e,s){s.d(e,{DI:function(){return i},L9:function(){return h},Ow:function(){return u},RD:function(){return o},Rg:function(){return v},Xd:function(){return l},cY:function(){return r},nA:function(){return f},pe:function(){return m},r_:function(){return d},uc:function(){return c},ul:function(){return p},v$:function(){return n}});var a=s(9312);function r(){return(0,a.U2)("/getRole",{})}function i(t){return(0,a.U2)(`/getAllRole/${t}`,{})}function n(t){return(0,a.U2)(`/selectPermsByRoleId/${t}`,{})}function l(t){return(0,a.U2)(`/selectElsePermsByRoleId/${t}`,{})}function o(t){return(0,a.v_)("/updatePermsByRoleId",t)}function c(t){return(0,a.v_)("deletePermsByRoleId",t)}function u(t,e){return(0,a.U2)(`/changeRoleState/${t}`,e)}function d(t){return(0,a.v_)("/insertRole",t)}function p(t){return(0,a.v_)("/updateRole",t)}function m(t){return(0,a.U2)("getRoleSalary",t)}function h(t){return(0,a.U2)("getUserSalary",t)}function f(t){return(0,a.U2)("leaveRole",t)}function v(t){return(0,a.U2)("getUserRole",t)}}}]);
//# sourceMappingURL=41.be3b330c.js.map