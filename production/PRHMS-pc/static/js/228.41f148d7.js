"use strict";(self["webpackChunkpc_web"]=self["webpackChunkpc_web"]||[]).push([[228],{228:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-container"},[e._m(0),t("div",{staticClass:"table-container"},[t("div",{staticClass:"navbar"},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"50px",inline:!0}},[t("el-form-item",{attrs:{label:"房号"}},[t("el-input",{attrs:{placeholder:"请输入房号"},model:{value:e.form.houseName,callback:function(t){e.$set(e.form,"houseName",t)},expression:"form.houseName"}})],1),t("el-form-item",{attrs:{label:"时间"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"请选择时间","picker-options":e.pickerBeginOption,"value-format":"yyyy-MM-DD"},model:{value:e.form.month,callback:function(t){e.$set(e.form,"month",t)},expression:"form.month"}})],1),t("el-button",{staticStyle:{height:"38px"},attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")])],1)],1),t("div",{staticClass:"table"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"454","default-sort":{prop:"date",order:"descending"}},scopedSlots:e._u([{key:"empty",fn:function(){return[t("el-empty",{attrs:{"image-size":200}})]},proxy:!0}])},[t("el-table-column",{attrs:{prop:"report",label:"时间",sortable:"",width:"180"}}),t("el-table-column",{attrs:{prop:"houseName",label:"房号",width:"180"}}),t("el-table-column",{attrs:{prop:"message",label:"详情"}}),t("el-table-column",{attrs:{prop:"state",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[0==r.row.state?t("span",[e._v("待处理")]):t("span",[e._v("已处理")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{type:"primary",size:"small",disabled:e.isGet},on:{click:function(t){return e.openDrawer("show",r.row)}}},[e._v("查 看")]),t("el-button",{attrs:{type:"danger",size:"small",disabled:e.isDel||"1"==r.row.state},on:{click:function(t){return e.deleteRepair(r.row)}}},[e._v("取 消")])]}}])})],1)],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,background:"",layout:"prev, pager, next",total:e.pagination.total},on:{"current-change":e.handleCurrentChange}})],1),t("div",{staticClass:"drawer-container"},[t("el-drawer",{attrs:{title:e.drawerTitle,size:"35%",visible:e.isShowDrawer,"before-close":e.handleClose},on:{"update:visible":function(t){e.isShowDrawer=t}}},[t("div",{staticClass:"bg"},[t("div",{staticClass:"main"},[t("el-descriptions",{attrs:{title:" 维修信息",column:2}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"primary",size:"small",disabled:e.isEdit||"已处理"==e.state},on:{click:function(t){e.dialogVisible=!0}}},[e._v("确认维修")])],1),t("el-descriptions-item",{attrs:{label:"上报时间"}},[e._v(e._s(e.repair.report))]),t("el-descriptions-item",{attrs:{label:"维修时间"}},[e._v(e._s(e.repair.fix))]),t("el-descriptions-item",{attrs:{label:"房号"}},[e._v(e._s(e.repair.houseName))]),t("el-descriptions-item",{attrs:{label:"维修员"}},[e._v(e._s(e.repair.name))]),t("el-descriptions-item",{attrs:{label:"详情"}},[e._v(e._s(e.repair.message))]),t("el-descriptions-item",{attrs:{label:"维修信息"}},[e._v(e._s(e.repair.remark))]),t("el-descriptions-item",{attrs:{label:"状态"}},[e._v(e._s(e.state))]),t("el-descriptions-item",{attrs:{label:"维修金额"}},[e._v(e._s(e.repair.price))])],2)],1)])])],1),t("div",{staticClass:"dialog"},[t("el-dialog",{attrs:{title:"填写维修信息",visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"repairForm",attrs:{model:e.repairForm,"label-width":"100x",rules:e.rules}},[t("el-form-item",{attrs:{label:"维修金额",prop:"price"}},[t("el-input",{model:{value:e.repairForm.price,callback:function(t){e.$set(e.repairForm,"price",t)},expression:"repairForm.price"}})],1),t("el-form-item",{attrs:{label:"维修信息",prop:"remark"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.repairForm.remark,callback:function(t){e.$set(e.repairForm,"remark",t)},expression:"repairForm.remark"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.reset}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleRepair()}}},[e._v("确 定")])],1)],1)],1)])])},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-container"},[t("h1",[e._v("维 修 管 理")])])}],s=r(6585),n=r(9312);function o(e,t){return(0,n.U2)(`getAllRepair/${e}`,t)}function l(e){return(0,n.U2)("deleteRepair",e)}function c(e){return(0,n.U2)("getRepairByRepairId",e)}function u(e){return(0,n.U2)("completeRepair",e)}var p=r(9176),m={data(){const e=(e,t,r)=>{(0,p.BP)(t)?r():r(new Error("请输入数字"))};return{pickerBeginOption:{disabledDate:e=>e.getTime()>Date.now()},form:{month:"",houseName:""},tableData:[],pagination:{currentPage:1,pageSize:7,total:0},isShowDrawer:!1,drawerType:"",repair:{},state:"",dialogVisible:!1,repairForm:{price:"",remark:""},rules:{price:[{required:!0,message:"请输入维修金额",trigger:"blur"},{validator:e,message:"维修金额必须为数字值",trigger:"blur"}],remark:[{required:!0,message:"请填写维修信息",trigger:"blur"}]}}},created(){this.getAll()},methods:{async getAll(){const e=`${this.pagination.currentPage}/${this.pagination.pageSize}`,{data:t}=await o(e,{houseName:this.form.houseName,report:this.form.month});this.tableData=t.records,this.pagination.currentPage=t.current,this.pagination.total=t.total,this.pagination.pageSize=t.size},handleCurrentChange(e){this.pagination.currentPage=e,this.getAll()},search(){this.getAll(),this.form={}},async openDrawer(e,t){try{if(this.isShowDrawer=!0,this.drawerType=e,0==t.state)this.state="待处理",this.repair=t;else{this.state="已处理";const{data:e}=await c({repairId:t.repairId});this.repair=e}}catch(r){console.log(r)}},handleClose(e){this.$confirm("确认关闭？").then((t=>{e()})).catch((e=>{}))},deleteRepair(e){this.$confirm("确定要取消维修吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await l(e),this.$message.success("取消成功")}catch(t){console.log(t)}finally{this.getAll()}})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},handleRepair(){this.$refs.repairForm.validate((async e=>{e&&this.$confirm("确定已处理维修了吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{this.repair={...this.repair,...this.repairForm,state:1,userId:this.$store.getters.userId},await u(this.repair),this.$message.success("处理完成")}catch(e){console.log(e)}finally{this.reset(),this.openDrawer("show",this.repair),this.getAll()}})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}))},reset(){this.dialogVisible=!1,this.repairForm={price:"",remark:""}}},computed:{isAdd(){return s.kL(this.$route.params.type)},isDel(){return s.bK(this.$route.params.type)},isUp(){return s.EN(this.$route.params.type)},isPull(){return s.kX(this.$route.params.type)},isEdit(){return s.mi(this.$route.params.type)},isGet(){return s.Xu(this.$route.params.type)},drawerTitle(){let e="默认大标题";return"show"===this.drawerType&&(e="查 看 维 修 信 息"),e}}},d=m,h=r(1001),f=(0,h.Z)(d,a,i,!1,null,"88167cc2",null),g=f.exports},6585:function(e,t,r){function a(e){const t="1";return c(e,t)}function i(e){const t="2";return c(e,t)}function s(e){const t="3";return c(e,t)}function n(e){const t="4";return c(e,t)}function o(e){const t="5";return c(e,t)}function l(e){const t="6";return c(e,t)}function c(e,t){let r=e.split("").filter((e=>!isNaN(e)));return!r.includes(t)}r.d(t,{EN:function(){return s},Xu:function(){return l},bK:function(){return i},kL:function(){return a},kX:function(){return n},mi:function(){return o}})},9176:function(e,t,r){function a(e){return/^1[3-9]\d{9}$/.test(e)}function i(e){let t=!0;return Object.keys(e).forEach((function(r){null!==e[r]&&""!=e[r]&&(t=!1)})),t}function s(e){return"NaN"!=parseFloat(e).toString()}function n(e){return""===e||null===e}r.d(t,{BP:function(){return s},Lp:function(){return a},kz:function(){return i},n3:function(){return n}})}}]);
//# sourceMappingURL=228.41f148d7.js.map