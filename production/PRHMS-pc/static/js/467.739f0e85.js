"use strict";(self["webpackChunkpc_web"]=self["webpackChunkpc_web"]||[]).push([[467],{2129:function(t,e,r){r.d(e,{Z:function(){return u}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[0==t.active?e("div",[e("p",{staticClass:"header"},[t._v("订单编号："+t._s(t.order.outTradeNo))]),e("div",{staticClass:"pay"},[t._v(t._s(t.payTitle))]),e("p",{staticClass:"header"},[t._v("请选择支付方式：")]),e("div",{staticStyle:{"margin-top":"30px","padding-left":"15px"}},[e("el-button",{on:{click:t.alipay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("支付宝支付")]),e("el-button",{on:{click:t.cashpay}},[e("i",{staticClass:"iconfont",staticStyle:{"margin-right":"5px",color:"#1296db","font-size":"20px"}},[t._v("")]),t._v("现金支付")])],1),e("p",{staticStyle:{color:"#303133","font-size":"14px",padding:"25px 15px 0"}},[t._v("*支付后请点击此"),e("el-button",{attrs:{type:"text"},on:{click:t.judgePay}},[t._v("刷新")])],1)]):t._e(),1==t.active?e("div",[e("el-result",{attrs:{icon:"success",title:"支付成功",subTitle:`缴费成功，${t.count}秒后关闭页面`}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.close}},[t._v("确定")])],1)],2)],1):t._e()])},i=[],a=r(7535),s={data(){return{active:0,count:"",timer:""}},props:{order:{type:Object,default:()=>({})}},computed:{payTitle(){return console.log(this.order),`待支付：￥${this.order.total}`}},methods:{async alipay(){this.judgePay();try{const{data:t}=await(0,a.Gh)({...this.order,subject:"押金",userId:this.$store.getters.userId}),e=window.open("","_target");e.document.write(t),e.focus()}catch(t){console.log(t)}},cashpay(){this.judgePay(),this.$confirm("确定收款成功, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(0,a.bD)({...this.order,userId:this.$store.getters.userId}),this.active++}))},async judgePay(){try{const{data:t}=await(0,a.v6)(this.order);t>0&&(this.$message.success("支付成功"),this.payTitle=`已支付：￥${this.order.total}`,this.active++)}catch(t){console.log(t)}},countDown(){const t=3;this.timer||(this.count=t,this.timer=setInterval((()=>{this.count>1&&this.count<=t?this.count--:(clearInterval(this.timer),this.timer=null,this.close())}),1e3))},close(){this.$emit("closePayDrawer")}},watch:{active(t,e){1==t&&this.countDown()}}},o=s,l=r(1001),c=(0,l.Z)(o,n,i,!1,null,"1f71a2fa",null),u=c.exports},3467:function(t,e,r){r.r(e),r.d(e,{default:function(){return w}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main-container"},[t._m(0),e("div",{staticClass:"table-container"},[e("div",{staticClass:"navbar"},[e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"50px",inline:!0}},[e("el-form-item",{attrs:{label:"房号"}},[e("el-input",{attrs:{placeholder:"请输入房号"},model:{value:t.form.houseName,callback:function(e){t.$set(t.form,"houseName",e)},expression:"form.houseName"}})],1),e("el-form-item",{attrs:{label:"时间"}},[e("el-date-picker",{attrs:{type:"month",placeholder:"请选择时间","picker-options":t.pickerBeginOption,"value-format":"yyyy-MM"},model:{value:t.form.month,callback:function(e){t.$set(t.form,"month",e)},expression:"form.month"}})],1),e("el-button",{staticStyle:{height:"38px"},attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")])],1)],1),e("div",{staticClass:"table"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",height:"478","default-sort":{prop:"date",order:"descending"}},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":200}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"date",label:"时间",sortable:"",width:"120"}}),e("el-table-column",{attrs:{prop:"outTradeNo",label:"订单编号",width:"200"}}),e("el-table-column",{attrs:{prop:"houseName",label:"房号"}}),e("el-table-column",{attrs:{prop:"type",label:"类型"}}),e("el-table-column",{attrs:{prop:"total",label:"金额"}}),e("el-table-column",{attrs:{prop:"time",label:"上传时间"}}),e("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(r){return[e("el-button",{attrs:{size:"mini",disabled:t.isGet},on:{click:function(e){return t.showDrawer(r.row)}}},[t._v("查 看")]),"退款"!=r.row.type?e("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isAdd||1==r.row.state},on:{click:function(e){return t.openDrawer(r.row)}}},[t._v("缴 费")]):e("el-button",{attrs:{type:"primary",size:"mini",disabled:t.isAdd||1==r.row.state},on:{click:function(e){return t.payOut(r.row)}}},[t._v("退 款")])]}}])})],1)],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{"current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,background:"",layout:"prev, pager, next",total:t.pagination.total},on:{"current-change":t.handleCurrentChange}})],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:t.drawerTitle,visible:t.drawer,size:"50%"},on:{"update:visible":function(e){t.drawer=e}}},[e("order-detail",{attrs:{order:t.order,"table-data":t.misTable,detail:t.detail}})],1)],1),e("div",{staticClass:"drawer"},[e("el-drawer",{attrs:{title:t.PayTitle,visible:t.payDrawer,"destroy-on-close":!0,size:"50%"},on:{"update:visible":function(e){t.payDrawer=e}}},[e("pay",{attrs:{order:t.order},on:{closePayDrawer:t.closePayDrawer}})],1)],1)])])},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"header-container"},[e("h1",[t._v("缴 费 处 理")])])}],a=r(6585),s=r(7535),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"bg",staticStyle:{"padding-top":"5px"}},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 订单详细信息",column:3}},[e("el-descriptions-item",{attrs:{label:"房号"}},[t._v(t._s(t.order.houseName))]),e("el-descriptions-item",{attrs:{label:"时间"}},[t._v(t._s(t.order.date))]),e("el-descriptions-item",{attrs:{label:"类型"}},[t._v(t._s(t.order.type))]),e("el-descriptions-item",{attrs:{label:"电费单价"}},[t._v(t._s(t.detail.basicElectric))]),e("el-descriptions-item",{attrs:{label:"用电量"}},[t._v(t._s(t.detail.numElectric))]),e("el-descriptions-item",{attrs:{label:"电费"}},[t._v(t._s(t.detail.costElectric))]),e("el-descriptions-item",{attrs:{label:"水费单价"}},[t._v(t._s(t.detail.basicWater))]),e("el-descriptions-item",{attrs:{label:"用水量"}},[t._v(t._s(t.detail.numWater))]),e("el-descriptions-item",{attrs:{label:"水费"}},[t._v(t._s(t.detail.costWater))]),e("el-descriptions-item",{attrs:{label:"总费用"}},[t._v(t._s(t.order.total))]),e("el-descriptions-item",{attrs:{label:"房费"}},[t._v(t._s(t.order.housePrice))]),e("el-descriptions-item",{attrs:{label:"杂费"}},[t._v(t._s(t.detail.mis))]),e("el-descriptions-item",{attrs:{label:"付款状态"}},[t._v(t._s(t.state))]),e("el-descriptions-item",{attrs:{label:"支付方式"}},[t._v(t._s(t.order.operation))]),e("el-descriptions-item",{attrs:{label:"支付时间"}},[t._v(t._s(t.order.payTime))]),e("el-descriptions-item",{attrs:{label:"处理人"}},[t._v(t._s(t.order.name))]),e("el-descriptions-item",{attrs:{label:"上传时间"}},[t._v(t._s(t.order.time))])],1)],1)]),e("div",{staticClass:"bg"},[e("div",{staticClass:"main"},[e("el-descriptions",{attrs:{title:" 杂费详情"}}),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",height:"250",size:"small"},scopedSlots:t._u([{key:"empty",fn:function(){return[e("el-empty",{attrs:{"image-size":80}})]},proxy:!0}])},[e("el-table-column",{attrs:{prop:"baseName",label:"收费名称"}}),e("el-table-column",{attrs:{prop:"price",label:"价格(月/元)",width:"120"}}),e("el-table-column",{attrs:{prop:"remark",label:"收费详情",width:"280"}}),e("el-table-column",{attrs:{prop:"time",label:"录入时间"}})],1)],1)])])},l=[],c={props:{order:{type:Object,default:()=>({})},tableData:{type:Array,default:()=>[]},detail:{type:Object,default:()=>({})}},computed:{state(){return"1"==this.order.state?"已缴费":"待缴费"}}},u=c,d=r(1001),p=(0,d.Z)(u,o,l,!1,null,"68d2ca35",null),f=p.exports,h=r(2900),m=r(5364),y=r(4980),b=r(2129),g={components:{OrderDetail:f,Pay:b.Z},data(){return{pickerBeginOption:{disabledDate:t=>t.getTime()>Date.now()},form:{month:"",houseName:""},tableData:[],pagination:{currentPage:1,pageSize:8,total:0},drawer:!1,drawerTitle:"",order:{},misTable:[],detail:{},payDrawer:!1,PayTitle:""}},created(){this.getAll()},methods:{payOut(t){this.$prompt("请输入密码,完成退款操作","退款",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"password",inputPattern:/^\w{5,12}$/,inputErrorMessage:"密码格式不正确"}).then((async({value:e})=>{try{await(0,h.uo)({password:e,username:this.$store.getters.username}),await(0,s.bD)({...t,userId:this.$store.getters.userId}),this.$message.success("系统记账成功...")}catch(r){console.log(r)}finally{this.getAll()}})).catch((()=>{this.$message({type:"info",message:"取消输入"})}))},async getAll(){try{const t=`${this.pagination.currentPage}/${this.pagination.pageSize}`,{data:e}=await(0,s._z)(t,{houseName:this.form.houseName,time:this.form.month});this.tableData=e.records,this.pagination.currentPage=e.current,this.pagination.total=e.total,this.pagination.pageSize=e.size}catch(t){console.log(t)}},handleCurrentChange(t){this.pagination.currentPage=t,this.getAll()},search(){this.getAll(),this.form={month:"",houseName:""}},async showDrawer(t){try{this.detail={};const{data:e}=await(0,m.Sh)({orderId:t.orderId});if(this.misTable=e,"押金"!=t.type){const{data:e}=await(0,y.GC)({rentId:t.rentId,time:t.date});this.detail=e}if(""!=t.userId&&null!=t.userId){const{data:e}=await(0,h.oY)(t.userId);t.name=e}this.drawerTitle=`订单编号:${t.outTradeNo}`,this.order=t,this.drawer=!0}catch(e){console.log(e)}},openDrawer(t){this.order=t,this.PayTitle=`缴纳${t.type}`,this.payDrawer=!0},closePayDrawer(){this.getAll(),this.payDrawer=!1}},computed:{isAdd(){return a.kL(this.$route.params.type)},isDel(){return a.bK(this.$route.params.type)},isUp(){return a.EN(this.$route.params.type)},isPull(){return a.kX(this.$route.params.type)},isEdit(){return a.mi(this.$route.params.type)},isGet(){return a.Xu(this.$route.params.type)},isTooggle(){return!(this.multipleSelection.length>0)}}},v=g,_=(0,d.Z)(v,n,i,!1,null,"c81ecdc8",null),w=_.exports},5364:function(t,e,r){r.d(e,{Cj:function(){return u},FE:function(){return s},Q$:function(){return l},Sh:function(){return f},hU:function(){return c},mZ:function(){return d},nx:function(){return p},oC:function(){return o},uX:function(){return i},wS:function(){return a}});var n=r(9312);function i(t){return(0,n.v_)("insertBasic",t)}function a(t,e){return(0,n.U2)(`getAllBasic/${t}`,e)}function s(){return(0,n.U2)("getBasic",{})}function o(t){return(0,n.U2)("getBasicByUserId",t)}function l(t){return(0,n.U2)("changeMiscellaneousState",t)}function c(t){return(0,n.U2)("getNoBasicByRentId",t)}function u(t){return(0,n.U2)("insertMiscellaneous",t)}function d(t){return(0,n.U2)("deleteBasic",t)}function p(t){return(0,n.v_)("updateBasic",t)}function f(t){return(0,n.U2)("getOrderMis",t)}},4980:function(t,e,r){r.d(e,{$T:function(){return b},Fo:function(){return p},GC:function(){return v},JQ:function(){return c},KH:function(){return m},Wm:function(){return d},_L:function(){return a},_x:function(){return s},cs:function(){return u},gD:function(){return h},i8:function(){return f},iJ:function(){return l},mw:function(){return i},n$:function(){return o},oD:function(){return _},rQ:function(){return y},rb:function(){return g}});var n=r(9312);function i(){return(0,n.Ab)("sheetElectricExcel",{})}function a(){return(0,n.Ab)("sheetWaterExcel",{})}function s(t){return(0,n.cd)("getElectricExcel",t)}function o(t){return(0,n.cd)("getWaterExcel",t)}function l(t){return(0,n.v_)("judgeElectric",t)}function c(t){return(0,n.v_)("judgeWater",t)}function u(t){return(0,n.v_)("toggleElectric",t)}function d(t){return(0,n.v_)("toggleWater",t)}function p(t,e){return(0,n.U2)(`getAllCost/${t}`,e)}function f(t){return(0,n.U2)("updateElectricByCostId",t)}function h(t){return(0,n.U2)("updateWaterByCostId",t)}function m(t){return(0,n.U2)("deleteCost",t)}function y(t){return(0,n.Ab)("generatePersonCost",t)}function b(t){return(0,n.Ab)("generateAllCost",t)}function g(t){return(0,n.U2)("judgeCost",t)}function v(t){return(0,n.U2)("getCostByRentId",t)}function _(t){return(0,n.Ab)("getAllCostExcel",t)}},7535:function(t,e,r){r.d(e,{Gh:function(){return s},IN:function(){return l},_z:function(){return c},bD:function(){return a},gZ:function(){return i},v6:function(){return o}});var n=r(9312);function i(t){return(0,n.U2)("generateOrder",t)}function a(t){return(0,n.v_)("payByCash",t)}function s(t){return(0,n.v_)("payByAlipay",t)}function o(t){return(0,n.U2)("judgePay",t)}function l(t){return(0,n.U2)("getOrderByRentId",t)}function c(t,e){return(0,n.U2)(`getAllOrder/${t}`,e)}},6585:function(t,e,r){function n(t){const e="1";return c(t,e)}function i(t){const e="2";return c(t,e)}function a(t){const e="3";return c(t,e)}function s(t){const e="4";return c(t,e)}function o(t){const e="5";return c(t,e)}function l(t){const e="6";return c(t,e)}function c(t,e){let r=t.split("").filter((t=>!isNaN(t)));return!r.includes(e)}r.d(e,{EN:function(){return a},Xu:function(){return l},bK:function(){return i},kL:function(){return n},kX:function(){return s},mi:function(){return o}})}}]);
//# sourceMappingURL=467.739f0e85.js.map