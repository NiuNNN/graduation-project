{"version":3,"file":"static/js/167.4c0125cb.js","mappings":"wJAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,QAAQ,CAACG,IAAI,SAASC,YAAY,CAAC,QAAU,QAAQC,MAAM,CAAC,KAAO,OAAO,OAAS,cAAcC,GAAG,CAAC,OAASR,EAAIS,gBAAgBP,EAAG,MAAM,CAACQ,WAAW,CAAC,CAACC,KAAK,aAAaC,QAAQ,eAAeC,MAAOb,EAAIc,WAAYC,WAAW,eAAeR,MAAM,CAAC,IAAMP,EAAIgB,OAAO,IAAM,IAAIR,GAAG,CAAC,MAAQR,EAAIiB,gBAAgBf,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,WAAW,CAACK,MAAM,CAAC,KAAO,QAAQC,GAAG,CAAC,MAAQR,EAAIiB,iBAAiB,KAAKf,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,WAAW,CAACK,MAAM,CAAC,MAAQ,UAAU,UAAU,GAAG,KAAO,UAAU,GAAM,eAAcN,KAAKiB,OAAOC,QAAQC,cAAclB,EAAG,WAAW,CAACK,MAAM,CAAC,MAAQ,UAAU,UAAU,GAAG,KAAO,UAAU,GAAM,aAAYN,KAAKiB,OAAOC,QAAQC,cAAclB,EAAG,WAAW,CAACK,MAAM,CAAC,MAAQ,UAAU,UAAU,GAAG,KAAO,WAAW,GAAK,eAAe,GAAGL,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,aAAa,CAACI,YAAY,CAAC,MAAQ,OAAOC,MAAM,CAAC,MAAQ,GAAG,KAAO,QAAQC,GAAG,CAAC,MAAQR,EAAIqB,SAAS,CAACrB,EAAIsB,GAAG,cAAc,IAC7jC,EACIC,EAAkB,G,UCkBtB,GACAC,OACA,OACAV,WAAAW,EAAA,MACAT,OAAA,GAEA,EACAU,UACA,KAAAV,OAAA,KAAAE,OAAAC,QAAAH,MACA,EACAW,QAAA,CACAV,eACA,KAAAW,MAAAC,OAAAC,OACA,EAKArB,aAAAsB,GACA,KAAAC,OAAAC,UACA,MAAAC,EAAAH,EAAAI,OAAAD,MACA,OAAAA,EAAAE,QAGA,KAAAC,mBAAAH,EAAA,KAEA,MAAAI,EAAA,IAAAC,WACAD,EAAAE,cAAAN,EAAA,IACAI,EAAAG,OAAA,UAGA,KAAAzB,OAAAe,EAAAI,OAAAO,OACA,MAAAC,EAAA,IAAAC,SACAD,EAAAE,OAAA,OAAAX,EAAA,IACAS,EAAAE,OAAA,gBAAA3B,OAAAC,QAAAC,gBACA0B,EAAAA,EAAAA,IAAAH,GACA,KAAAzB,OAAA6B,SAAA,gBACA,KAAAf,OAAAgB,QAAA,UAEA,CAEA,EAEAX,mBAAAY,GACA,MAAAC,EAAA,eAAAD,EAAAE,KACAC,EAAAH,EAAAI,KAAA,YAQA,OANAH,GACA,KAAAI,SAAAC,MAAA,qBAEAH,GACA,KAAAE,SAAAC,MAAA,qBAEAL,GAAAE,CACA,EACA/B,SACA,KAAAH,OAAA6B,SAAA,cACA,IC7E8P,I,UCQ1PS,GAAY,OACd,EACAzD,EACAwB,GACA,EACA,KACA,WACA,MAIF,EAAeiC,EAAiB,O","sources":["webpack://h5_web/./src/views/user/index.vue","webpack://h5_web/src/views/user/index.vue","webpack://h5_web/./src/views/user/index.vue?212a","webpack://h5_web/./src/views/user/index.vue?3117"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"avatar\"},[_c('input',{ref:\"iptRef\",staticStyle:{\"display\":\"none\"},attrs:{\"type\":\"file\",\"accept\":\"image/jpeg\"},on:{\"change\":_vm.onFileChange}}),_c('img',{directives:[{name:\"imageerror\",rawName:\"v-imageerror\",value:(_vm.defaultImg),expression:\"defaultImg\"}],attrs:{\"src\":_vm.avatar,\"alt\":\"\"},on:{\"click\":_vm.uploadAvatar}}),_c('div',{staticClass:\"camera\"},[_c('van-icon',{attrs:{\"name\":\"edit\"},on:{\"click\":_vm.uploadAvatar}})],1)]),_c('div',{staticClass:\"mian\"},[_c('van-cell',{attrs:{\"title\":\"个 人 资 料\",\"is-link\":\"\",\"icon\":\"contact\",\"to\":`userprofile/${this.$store.getters.username}`}}),_c('van-cell',{attrs:{\"title\":\"住 房 信 息\",\"is-link\":\"\",\"icon\":\"hotel-o\",\"to\":`userhouse/${this.$store.getters.username}`}}),_c('van-cell',{attrs:{\"title\":\"密 码 设 置\",\"is-link\":\"\",\"icon\":\"shield-o\",\"to\":\"password\"}})],1),_c('div',{staticClass:\"footer\"},[_c('van-button',{staticStyle:{\"width\":\"80%\"},attrs:{\"round\":\"\",\"type\":\"info\"},on:{\"click\":_vm.logout}},[_vm._v(\"退 出 登 录\")])],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"container\">\r\n    <div class=\"avatar\">\r\n      <input type=\"file\" accept=\"image/jpeg\" style=\"display: none\" ref=\"iptRef\" @change=\"onFileChange\" />\r\n      <img v-imageerror=\"defaultImg\" :src=\"avatar\" alt=\"\" @click=\"uploadAvatar\" />\r\n      <div class=\"camera\"><van-icon name=\"edit\" @click=\"uploadAvatar\" /></div>\r\n    </div>\r\n    <div class=\"mian\">\r\n      <van-cell title=\"个 人 资 料\" is-link icon=\"contact\" :to=\"`userprofile/${this.$store.getters.username}`\" />\r\n      <van-cell title=\"住 房 信 息\" is-link icon=\"hotel-o\" :to=\"`userhouse/${this.$store.getters.username}`\" />\r\n      <van-cell title=\"密 码 设 置\" is-link icon=\"shield-o\" to=\"password\" />\r\n    </div>\r\n    <div class=\"footer\">\r\n      <van-button round type=\"info\" style=\"width: 80%\" @click=\"logout\">退 出 登 录</van-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { uploadAvatarAPI } from '@/api/user';\r\nexport default {\r\n  data() {\r\n    return {\r\n      defaultImg: require('@/assets/image/avatar_default.png'),\r\n      avatar: ''\r\n    };\r\n  },\r\n  created() {\r\n    this.avatar = this.$store.getters.avatar;\r\n  },\r\n  methods: {\r\n    uploadAvatar() {\r\n      this.$refs.iptRef.click();\r\n    },\r\n    /**\r\n     * 图片被修改后上传\r\n     * 通过转换为Base64进行回显\r\n     */\r\n    onFileChange(e) {\r\n      this.$toast.loading();\r\n      const files = e.target.files;\r\n      if (files.length === 0) {\r\n        return; // 说明文件选择的窗口打开了，但是它一个文件都没选择就点击了确定关闭了选择弹框\r\n      } else {\r\n        if (this.beforeAvatarUpload(files[0])) {\r\n          //校检上传的文件\r\n          const fr = new FileReader();\r\n          fr.readAsDataURL(files[0]); // 传入文件对象开始阅读\r\n          fr.onload = async e => {\r\n            // onload等待把文件读成base64字符串后会触发onload事件函数\r\n            // e.target.result的值就是读完的结果\r\n            this.avatar = e.target.result; // 赋予给变量，让他显示在img的src里\r\n            const form = new FormData();\r\n            form.append(`file`, files[0]);\r\n            form.append(`username`, this.$store.getters.username);\r\n            await uploadAvatarAPI(form);\r\n            this.$store.dispatch('user/getUser');\r\n            this.$toast.success('头像修改成功');\r\n          };\r\n        }\r\n      }\r\n    },\r\n    //校检函数\r\n    beforeAvatarUpload(file) {\r\n      const isJPG = file.type === 'image/jpeg';\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M;\r\n    },\r\n    logout() {\r\n      this.$store.dispatch('user/logout');\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  .avatar {\r\n    position: relative;\r\n    margin-top: 60px;\r\n    text-align: center;\r\n    img {\r\n      width: 120px;\r\n      height: 120px;\r\n      border-radius: 50%;\r\n      cursor: pointer;\r\n    }\r\n    .camera {\r\n      position: absolute;\r\n      right: 135px;\r\n      bottom: 5px;\r\n      width: 28px;\r\n      height: 28px;\r\n      background-color: #fff;\r\n      line-height: 28px;\r\n      text-align: center;\r\n      border-radius: 50%;\r\n      color: #858ebd;\r\n      box-shadow: 0px 4px 16px rgba(179, 192, 231, 0.32);\r\n      cursor: pointer;\r\n    }\r\n  }\r\n  .footer {\r\n    margin-top: 35px;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=5ab479ae&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=5ab479ae&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5ab479ae\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","ref","staticStyle","attrs","on","onFileChange","directives","name","rawName","value","defaultImg","expression","avatar","uploadAvatar","$store","getters","username","logout","_v","staticRenderFns","data","require","created","methods","$refs","iptRef","click","e","$toast","loading","files","target","length","beforeAvatarUpload","fr","FileReader","readAsDataURL","onload","result","form","FormData","append","uploadAvatarAPI","dispatch","success","file","isJPG","type","isLt2M","size","$message","error","component"],"sourceRoot":""}