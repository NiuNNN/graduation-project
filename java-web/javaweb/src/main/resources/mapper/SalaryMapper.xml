<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="niuniu.javaweb.mapper.SalaryMapper">
    <insert id="insert" parameterType="niuniu.javaweb.pojo.Salary">
        insert into salary (salary_name, price, remark, state, time, operation, old_price)
        values (#{salaryName}, #{price}, #{remark}, #{state}, current_timestamp, #{operation}, #{price})
    </insert>
    <update id="updateSalary">
        update salary
        set salary_name =#{salaryName},
        remark = #{remark},
        operation = #{operation}
        <if test="oldPrice !=null and oldPrice !=''">
            ,old_price = #{oldPrice},
            price = #{price},
            time = current_timestamp
        </if>
        where salary_id = #{salaryId}
    </update>
    <select id="selectSalaryCount" resultType="int">
        select count(*)
        from salary_role
        where salary_id = #{salaryId}
          and state !=0
    </select>
    <update id="deleteSalary">
        update salary
        set state = 0
        where salary_id = #{salaryId}
    </update>
    <select id="getAllSalary" resultType="niuniu.javaweb.pojo.Salary">
        select *
        from salary
        where state !=0
        order by state ${ew.customSqlSegment}
    </select>
    <select id="getSalaryByState" resultType="niuniu.javaweb.pojo.Salary">
        select *
        from salary
        where state = #{state}
    </select>
    <insert id="insertRoleSalary">
        insert into salary_role (salary_id, role_id, time, state)
        values (#{salaryId}, #{roleId}, current_timestamp, #{state})
    </insert>
    <update id="updateRoleSalary">
        update salary_role
        set state = #{state}
        where salary_id = #{salaryId}
          and role_id = #{roleId}
    </update>
    <select id="selectHasRoleSalary" resultType="int">
        select count(*)
        from salary_role
        where role_id = #{roleId}
          and salary_id = #{salaryId}
    </select>
</mapper>
